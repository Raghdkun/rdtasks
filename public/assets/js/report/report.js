(()=>{"use strict";var e=$("#department");$(document).ready((function(){$("#clientId").select2({width:"100%"}),e.select2({width:"100%"}),$("#projectIds").select2({width:"100%",placeholder:"All Projects"}),$("#userIds").select2({width:"100%",placeholder:"All Users"}),$("#tagIds").select2({width:"100%",placeholder:"Select Tags"}),$("#filterCreatedBy").select2()})),$(".select2-search__field").css("width","100%"),$("#start_date").datetimepicker({format:"YYYY-MM-DD",useCurrent:!0,locale:"ar"==languageName?"en":languageName,icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,maxDate:moment(),widgetPositioning:{horizontal:"left",vertical:"bottom"}}),$("#end_date").datetimepicker({format:"YYYY-MM-DD",useCurrent:!1,locale:"ar"==languageName?"en":languageName,icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,maxDate:moment(),widgetPositioning:{horizontal:"left",vertical:"bottom"}}),$("#start_date, #end_date").on("dp.show",(function(){matchWindowScreenPixels({startDate:"#start_date",endDate:"#end_date"},"rpt")})),$(window).resize((function(){matchWindowScreenPixels({startDate:"#start_date",endDate:"#end_date"},"rpt")})).trigger("resize"),$((function(){$("form").find("input:text").filter(":input:visible:first").first().focus()})),$("#start_date").on("dp.change",(function(e){$("#end_date").data("DateTimePicker").minDate(e.date)})),$("#end_date").on("dp.change",(function(e){$("#start_date").data("DateTimePicker").maxDate(e.date)})),e.on("change",(function(){var e,t;0!=+$(this).val()&&$("#clientId").val(null).trigger("change"),e=0===(e=parseInt($(this).val()))?"":e,$("#clientId").val(null).trigger("change"),$("#clientId").empty(),$.ajax({url:route("clients-of-department")+"?department_id="+e,type:"GET",success:function(e){var a=e.data,n='<option value="">All Clients</option>';$.each(a,(function(e,a){void 0===t&&(t=a),n+='<option value="'+a+'">'+e+"</option>"})),$("#clientId").html(n),$("#clientId").select2(),void 0!==t&&$("#clientId").val(t).trigger("change")}})})),$(document).on("change","#clientId",(function(){var e;$("#projectIds").empty(),0!=$(this).val()&&$("#projectIds").val(null).trigger("change"),""!=$(this).val()&&(e=0==(e=$(this).val())?"":e,$.ajax({url:route("projects-of-client")+"?client_id="+e,type:"GET",success:function(e){var t=document.createElement("textarea"),a=e.data;for(var n in a)t.innerHTML=a[n],a.hasOwnProperty(n)&&$("#projectIds").append($("<option>",{value:n,text:t.value}))}}))})),$("#projectIds").on("change",(function(){var e;$("#userIds").empty(),$("#userIds").val(null).trigger("change"),e=$(this).val().toString(),$.ajax({url:route("reports.users-of-projects")+"?projectIds="+e,type:"GET",success:function(e){var t=e.data;for(var a in t)t.hasOwnProperty(a)&&$("#userIds").append($("<option>",{value:a,text:t[a]}))}})})),$(document).on("click",".delete-btn",(function(e){var t=$(e.currentTarget).attr("data-id");deleteReport(route("reports.destroy",t))})),window.deleteReport=function(e){swal({title:deleteHeading+" !",text:deleteMessage+' "Report" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777ef",cancelButtonColor:"#d33",cancelButtonText:noMessages,confirmButtonText:yesMessages},(function(){$.ajax({url:e,type:"DELETE",dataType:"json",success:function(e){e.success&&(1==$("#report_table").DataTable().data().count()?$("#report_table").DataTable().page("previous").draw("page"):$("#report_table").DataTable().ajax.reload(null,!1)),swal({title:"Deleted!",text:"Report has been deleted.",type:"success",confirmButtonColor:"#6777EF",timer:2e3})},error:function(e){swal({title:"",text:e.responseJSON.message,type:"error",confirmButtonColor:"#6777EF",timer:5e3})}})}))};var t=$("#report_table").DataTable({language:{paginate:{previous:'<i class="fas fa-angle-left"></i>',next:'<i class="fas fa-angle-right"></i>'},info:showingText+" _START_ "+toText+" _END_ "+ofText+" _TOTAL_ "+entriesText},processing:!0,serverSide:!0,order:[[0,"asc"]],ajax:{url:route("reports.index"),data:function(e){e.filter_created_by=$("#filterCreatedBy").find("option:selected").val()}},columnDefs:[{targets:[1,2,3],width:"10%",className:"text-center"},{targets:[4],orderable:!1,className:"text-center",width:"80px"}],columns:[{data:function(e){var t=document.createElement("textarea");return t.innerHTML=e.name,t.value},name:"name"},{data:function(e){return format(e.start_date,"YYYY-MMM-DD")},name:"start_date"},{data:function(e){return format(e.end_date,"YYYY-MMM-DD")},name:"end_date"},{data:function(e){var t=document.createElement("textarea");return t.innerHTML=isEmpty(e.user)?"N/A":e.user.name,t.value},name:"owner_id"},{data:function(e){return actionTemplate({Url:route("reports.index"),viewText,editText,deleteText,id:e.id})},name:"id"}],fnInitComplete:function(){$(document).on("change","#filterClient,#filterCreatedBy",(function(){t.ajax.reload()}))}});$(document).on("click",".preview-btn",(function(){var e=$(this).closest("form"),t=jQuery(this);t.button("loading"),$(".enable_preview").prop("checked",!0);var n=e.serializeArray();n=n.slice(1),$.ajax({url:route("reports.preview"),type:"POST",data:n,success:function(e){$("section.section").append(e.data),a()},error:function(e){printErrorMessage("#validationErrorsBox",e)},complete:function(){t.button("reset")}})})),$(document).on("click",".save-btn",(function(){var e=jQuery(this);return e.button("loading"),""==$("#name").val().trim()?(displayErrorMessage("name field is required"),e.button("reset"),!1):""==$("#start_date").val()?(displayErrorMessage("start date field is required"),e.button("reset"),!1):""==$("#end_date").val()?(displayErrorMessage("end date field is required"),e.button("reset"),!1):void $(".report-form").submit()})),$(document).on("click",".cancel-btn",(function(){$(this).closest(".preview-wrapper").remove()}));var a=function(){$(document).on("click",".reports__department-row-title",(function(){$(this).find("i.fa-caret-up").toggleClass("fa-rotate"),$(this).parent().parent().find(".collapse-row").slideToggle()})),$(document).on("click",".reports__client-row-title",(function(){$(this).find("i.fa-caret-up").toggleClass("fa-rotate"),$(this).parent().next(".reports__client-container").slideToggle()})),$(document).on("click",".reports__project-header",(function(){$(this).find("i.fa-caret-up").toggleClass("fa-rotate"),$(this).parent().next(".reports__project-container").slideToggle()})),$(document).on("click",".reports__developer-header",(function(){$(this).find("i.fa-caret-up").toggleClass("fa-rotate"),$(this).parent().next(".reports__task-container").slideToggle()}))}})();