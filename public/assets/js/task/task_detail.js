(()=>{"use strict";$((function(){$("#editAssignTo").select2({width:"100%",placeholder:"Select Assignee"}),$("#editProjectId").select2({width:"100%",placeholder:"Select Project"}),$("#editStatus").select2({width:canManageStatus?"calc(100% - 44px)":"100%",placeholder:"Select Status"}),$("#editAssignee").select2({width:"100%",placeholder:"Select Assignee"}),canManageTags?$("#editTagIds").select2({width:"100%",tags:!0,placeholder:"Select Tags",sorter:function(e){return e.sort((function(e,t){return e.text>t.text?1:e.text<t.text?-1:0}))},createTag:function(e){var t=!1;if($("#editTagIds option").each((function(){$.trim(e.term).toUpperCase()===$.trim($(this).text()).toUpperCase()&&(t=!0)})),!t)return{id:e.term,text:e.term}}}):$("#editTagIds").select2({width:"100%",placeholder:"Select Tags"}),$("#editPriority").select2({width:"100%"}),$("#dueDate,#editDueDate").datetimepicker({format:"YYYY-MM-DD",useCurrent:!1,locale:"ar"==languageName?"en":languageName,icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,minDate:moment().millisecond(0).second(0).minute(0).hour(0)}),$("#dueDate, #editDueDate").on("dp.show",(function(){matchWindowScreenPixels({dueDate:"#dueDate",editDueDate:"#editDueDate"},"tsk")})),$(window).resize((function(){matchWindowScreenPixels({dueDate:"#dueDate",editDueDate:"#editDueDate"},"tsk")})).trigger("resize"),$('[data-toggle="tooltip"]').tooltip()}));var e=[];$(document).on("click",".edit-task-btn",(function(t){var a=$(t.currentTarget).attr("data-id");$.ajax({url:route("tasks.edit",a),type:"GET",success:function(t){if(t.success){var a=t.data.task,i=t.data.tags,n=document.createElement("textarea");$("#editTagIds").empty(),$.each(i,(function(e,t){n.innerHTML=t,$("#editTagIds").append($("<option>",{value:e,text:n.value}))}));a.description;var o=document.createElement("textarea");o.innerHTML=a.title,$("#tagId").val(a.id),$("#editTitle").val(o.value),$("#taskEditDescription").summernote("code",a.description),$("#editDueDate").val(a.due_date),$("#editProjectId").val(a.project.id).trigger("change"),$("#editStatus").val(a.status).trigger("change"),0==a.estimate_time_type||null==a.estimate_time?($("#editEstimateTimeDays").hide(),$("#editEstimateTimeHours").val(a.estimate_time).show(),$("#editHours").addClass("btn-primary text-white"),$("#editDays").removeClass("btn-primary text-white"),$("#editTypes").val(0)):($("#editEstimateTimeHours").hide(),$("#editEstimateTimeDays").val(a.estimate_time).show(),$("#editDays").addClass("btn-primary text-white"),$("#editHours").removeClass("btn-primary text-white"),$("#editTypes").val(1));var s=[],r=[];$(a.tags).each((function(e,t){s.push(t.id)})),$("#previewImageEdit").empty(),$(a.media).each((function(e,t){var i=a.attachments[e].file_name.split(".").pop().toLowerCase(),n=[];n=a.attachments[e].original_url,"xlsx"!==i&&"xls"!==i&&"csv"!==i||(n="/assets/img/xls_icon.png"),"pdf"===i&&(n="/assets/img/pdf_icon.png"),"docx"!==i&&"doc"!==i||(n="/assets/img/doc_icon.png");var o;o=[{id:a.attachments[e].id,url:a.attachments[e].original_url,image:n,username:a.created_user.name,downloadTask:route("tasks.index"),updated_at:moment(a.attachments[e].updated_at).fromNow(),createdId:a.created_user.id,loginUserId:loggedInUserId}],$("#previewImageEdit").append(prepareTemplateRender("#attachmentImage",o))})),0==a.media.length&&$("#noAttachmentFound").text("No attachments added yet"),$(a.task_assignee).each((function(t,a){r.push(a.id),e.push(a.id)})),$("#editTagIds").val(s).trigger("change"),$("#editAssignee").val(r).trigger("change"),$("#editPriority").val(a.priority).trigger("change"),setTimeout((function(){$.each(a.task_assignee,(function(e,t){$("#editAssignee option[value='"+t.id+"']").prop("selected",!0).trigger("change")})),$("#EditModal").appendTo("body").modal("show")}),1500)}},error:function(e){displayErrorMessage(e.responseJSON.message)}})})),$(document).on("submit","#addNewStatusForm",(function(e){e.preventDefault();var t=jQuery(this).find("#btnSave");t.button("loading"),$.ajax({url:"/status",type:"POST",data:$(this).serialize(),success:function(e){if($("#editStatus").empty(),e.success){displaySuccessMessage(e.message);var t="<option value=''>Select Status</option>";$.each(e.data.statuses,(function(e,a){t+="<option value='"+a+"'>"+e+"</option>",$("#editStatus").html(t)})),$("#editStatus").val(e.data.status.status).trigger("change.select2"),$("#addStatusModal").modal("hide")}},error:function(e){printErrorMessage("#validationErrorsBox",e)},complete:function(){t.button("reset")}})})),$(document).on("click",".add_modal",(function(e){e.preventDefault(),$("#addStatusModal").appendTo("body").modal("show")})),$("#addStatusModal").on("hidden.bs.modal",(function(){resetModalForm("#addNewStatusForm","#validationErrorsBox")})),$(document).on("submit","#editForm",(function(e){e.preventDefault();var t=""===$("<div />").html($("#taskEditDescription").summernote("code")).text().trim().replace(/ \r\n\t/g,""),a=jQuery(this).find("#btnTaskEditSave");if(a.button("loading"),$("#editTitle").val().length>250)return displayErrorMessage("The title may not be greater than 250 characters"),a.button("reset"),!1;if($("#taskEditDescription").summernote("isEmpty"))$("#taskEditDescription").val("");else if(t)return displayErrorMessage("Description field is not contain only white space"),a.button("reset"),!1;if(""==$("#editTitle").val().trim())return displayErrorMessage("Title field is not contain only white space"),a.button("reset"),!1;var n=$("#tagId").val(),o=getItemFromLocalStorage("task_id"),s=getItemFromLocalStorage("clockRunning");if(n===o&&"true"===s)return swal({title:"Warning",text:"Please stop timer before updating task.",type:"warning",confirmButtonColor:"#6777ef"}),a.button("reset"),!1;var r=$(this).serializeArray();i.summernote("code");$.ajax({url:route("tasks.update",n),type:"put",data:r,success:function(e){e.success&&($("#EditModal").modal("hide"),displaySuccessMessage("Task updated successfully."),location.href=taskUrl+e.data.project.prefix+"-"+e.data.task_number)},error:function(e){a.button("reset"),printErrorMessage("#editValidationErrorsBox",e)}})})),$("#EditModal").on("hidden.bs.modal",(function(){i.summernote("code",""),$("#editDueDate").data("DateTimePicker").clear(),$("#editEstimateTimeHours").data("DateTimePicker").date("00:00"),$("#editDays").removeClass("btn btn-primary text-white"),$("#editHours").addClass("btn btn-primary text-white"),$("#editTypes").val(0),$("#editEstimateTimeDays").hide().val(""),$("#editEstimateTimeHours").show().val(""),resetModalForm("#editForm","#editValidationErrorsBox")})),$(document).on("click",'[data-toggle="lightbox"]',(function(e){e.preventDefault(),$(this).ekkoLightbox({showArrows:!1})})),Dropzone.options.dropzone={maxFilesize:12,maxFiles:25,renameFile:function(e){return(new Date).getTime()+"_"+(Math.random().toString(36).substring(2,8)+Math.random().toString(36).substring(2,8))+"_"+e.name.replace(/\s/g,"").replace(/\(/g,"_").replace(/\)/g,"")},thumbnailWidth:125,acceptedFiles:".png,.jpeg,.jpg,.pdf,.doc,.docx,.xls,.xlsx,.csv,.zip,.html,.rar,.css,.js,.txt,.json",dictFileTooBig:"File is too big ({{filesize}}MB). Max filesize: {{maxFilesize}}MB.",addRemoveLinks:!0,dictRemoveFile:"x",timeout:5e4,init:function(){var e=this;function t(e,t,a){var i=e.name.split(".").pop();if("pdf"==i?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/pdf_icon.png"):-1!=i.indexOf("doc")||-1!=i.indexOf("docx")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/doc_icon.png"):-1!=i.indexOf("xls")||-1!=i.indexOf("xlsx")||-1!=i.indexOf("csv")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/xls_icon.png"):-1!=i.indexOf("zip")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/zip.png"):-1!=i.indexOf("rar")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/rar.png"):-1!=i.indexOf("html")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/html.png"):-1!=i.indexOf("css")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/css.png"):-1!=i.indexOf("json")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/json.png"):-1!=i.indexOf("js")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/js.png"):-1!=i.indexOf("txt")&&$(e.previewElement).find(".dz-image img").attr("src","/assets/img/text.png"),"undefined"===$(e.previewElement).find(".download-link").attr("href")&&$(e.previewElement).find(".download-link").hide(),$(e.previewElement).find(".download-link").length<1){var n=document.createElement("a");n.setAttribute("href",downloadTasks+"/media/"+a+"?task_id="+taskId),n.setAttribute("class","download-link"),n.innerHTML="<br>Download",e.previewElement.appendChild(n)}$(".dz-image").last().find("img").attr({width:"100%",height:"100%"})}$.get(route("task.attachments",taskId),(function(t){$.each(t.data,(function(t,a){var i={name:a.name,id:a.id};e.options.addedfile.call(e,i,i.id),e.options.thumbnail.call(e,i,a.url),e.emit("complete",i),e.emit("thumbnail",i,a.url,i.id),$(".dz-remove").eq(t).attr("data-file-id",a.id),$(".dz-remove").eq(t).attr("data-file-url",a.url)}))})),this.on("thumbnail",(function(e,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;$(e.previewTemplate).find(".dz-details").css("display","none"),t(e,a,i);var n=e.name.split("."),o=n[0].replace(/\s/g,"").replace(/\(/g,"_").replace(/\)/g,""),s=e.name.split(".").pop(),r="",d=!0;$(e.previewElement).find(".download-link").on("click",(function(){d=!1})),$.inArray(s,["jpg","JPG","jpeg","png","PNG"])>-1&&(r='<a class="'+o+'" data-fancybox="gallery" href="'+a+'" data-toggle="lightbox" data-gallery="example-gallery"></a>',$(".previewEle").append(r)),e.previewElement.addEventListener("click",(function(){if(d){var t=e.previewElement.querySelector("[data-dz-name]").innerHTML,i=t.split(".").pop();if($.inArray(i,["jpg","JPG","jpeg","png","PNG"])>-1){var n=t.split(".")[0];$("."+n).trigger("click")}else window.open(a,"_blank")}d=!0}))})),this.on("addedfile",(function(e,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t(e,a,i)}))},processing:function(){$(".dz-remove").html("x"),$(".dz-details").hide()},removedfile:function(e){swal({title:deleteHeading+" !",text:deleteMessage+' "'+deleteAttachment+'" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777EF",cancelButtonColor:"#d33",cancelButtonText:noMessages,confirmButtonText:yesMessages},(function(){var t,a=e.previewElement.querySelector("[data-file-id]").getAttribute("data-file-id");return screenLock(),$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="_token"]').attr("content")},type:"post",url:route("task.delete-attachment",a),data:{filename:name,task_id:taskId},complete:function(){location.reload(!0)},error:function(e){displayErrorMessage(e.responseJSON.message)}}),null!=(t=e.previewElement)?t.parentNode.removeChild(e.previewElement):void 0}))},success:function(e,t){var a=t.data,i=e.previewElement.querySelector("[data-dz-name]"),n=a.file_name,o=n.split("."),s=o[0],r=o[1],d=i.innerHTML.split(".")[0].replace(/\s/g,"").replace(/\(/g,"_").replace(/\)/g,"");i.innerHTML=n,$(e.previewTemplate).find(".dz-remove").attr("data-file-id",a.id),$(e.previewTemplate).find(".dz-remove").attr("data-file-url",a.file_url),$(e.previewElement).find(".download-link").attr("href",downloadTasks+"/media/"+a.id+"?task_id="+taskId),$.inArray(r,["jpg","JPG","jpeg","png","PNG"])>-1?($(".previewEle").find("."+d).attr("href",a.file_url),$(".previewEle").find("."+d).attr("class",s)):(e.previewElement.addEventListener("click",(function(){window.open(a.file_url,"_blank")})),$(e.previewElement).find(".download-link").addClass("sdfaskdfjaksdfjaskldfjlasdf"))},error:function(e,t){var a,i=e.name.split(".").pop().toLowerCase();return-1==$.inArray(i,["png","jpg","jpeg","xls","xlsx","csv","pdf","doc","docx","zip","html","css","rar","txt","js","json"])?swal({title:"Error!",text:"The attachment must be a file of type: jpeg, jpg, png, xls, xlsx, pdf, doc, zip, rar, html, css, js, txt, json, csv, docx",type:"error",confirmButtonColor:"#6777EF",timer:5e3}):t.message?swal("Error!",t.message,"error"):swal("Error!",t,"error"),null!=(a=e.previewElement)?a.parentNode.removeChild(e.previewElement):void 0}},$(document).on("click","#btnComment",(function(e){var t=a.summernote("code"),i=jQuery(this).find("#btnComment"),n=$(this).data("edit-mode"),o=$(this).data("comment-id"),s=""===$("<div />").html($("#commentContainer").summernote("code")).text().trim().replace(/ \r\n\t/g,""),r=null;return a.summernote("isEmpty")?(displayErrorMessage("Please Enter comment"),!1):s?(displayErrorMessage("Comment is not contain only white space"),!1):(r=0===n?route("task.comments",taskId):route("task.update-comment",[taskId,o]),i.button("loading"),void $.ajax({url:r,type:"post",data:{comment:t},success:function(e){e.success&&(0===n?function(e){var t=function(e){var t=e.id,a="";return e.created_by==authId&&(a='<a class="dropdown dropdown-list-toggle"><a href="javascript:void(0)" data-toggle="dropdown" class="notification-toggle action-dropdown d-none position-xs-bottom uCommentToggle"><i class="fas fa-ellipsis-v action-toggle-mr"></i></a><div class="dropdown-menu dropdown-menu-right"><div class="dropdown-list-content dropdown-list-icons"><a href="#" class="dropdown-item dropdown-item-desc edit-comment" data-id="'+t+'"><i class="fas fa-edit mr-2 card-edit-icon"></i>Edit</a><a href="#" class="dropdown-item dropdown-item-desc del-comment" data-id="'+t+'"><i class="fas fa-trash mr-2 card-delete-icon"></i>Delete</a></div></div></a>'),'<div class="task-chat-item position-relative comment-item-'+t+' task-chat-right" data-comment-item="'+t+'"><img src="'+e.created_user.img_avatar+'" class="user__img profile uProfileLayout mr-3" alt="User Image" data-toggle="tooltip" data-html="true" title="'+e.created_user.name+'"/><div class="task-chat-details"><div class="task-chat-text comment-'+t+'">'+e.comment+'</div><div class="task-chat-time">Just now</div></div>'+a+"</div>"}(e);$(".comments .activities").removeClass("d-none"),$(".comments .activities").append(t),a.summernote("code",""),$(".no_comments").hide(),$(".task-chat-content").scrollTop($(".task-chat-content").get(0).scrollHeight)}(e.data.comment):($(".comment-"+o).html(t),a.summernote("code",""),$("#btnComment").data("edit-mode",0),$("#btnComment").data("comment-id",0))),i.button("reset")},error:function(e){i.button("reset"),printErrorMessage("#taskValidationErrorsBox",e)}}))})),$(document).on("click",".del-comment",(function(e){var t=$(this).data("id");swal({title:"Delete !",text:'Are you sure want to delete this "Comment" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777EF",cancelButtonColor:"#d33",cancelButtonText:"No",confirmButtonText:"Yes"},(function(){$.ajax({url:route("task.delete-comment",[taskId,t]),type:"DELETE",success:function(e){e.success&&function(e,t){var i=".comment-item-"+e;$("div").remove(i),$.ajax({url:route("task.comments-count",t),type:"GET",success:function(e){a.summernote("code",""),$("#btnComment").data("edit-mode",0),0==e.data&&($(".no_comments").show(),$(".no_comments").removeClass("d-none"),$(".task-chat-content").addClass("d-none"))},error:function(e){displayErrorMessage(e.responseJSON.message)}})}(t,taskId),swal({title:"Deleted!",text:"Comment has been deleted.",type:"success",confirmButtonColor:"#6777EF",timer:2e3})},error:function(e){swal({title:"",text:e.responseJSON.message,type:"error",confirmButtonColor:"#6777EF",timer:5e3})}})}))}));var t=[];$(document).on("click",".edit-comment",(function(){var e=$(this).data("id"),t=$.trim($(".comment-"+e).html());a.summernote("code",""),a.summernote("code",t),$("#btnComment").data("edit-mode",1),$("#btnComment").data("comment-id",e)})),window.setCommentEditData=function(e){t[e]=$("#commentEditContainer"+e).summernote({placeholder:"Add Comment...",minHeight:200,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]]});var a=$.trim($(".comment-display-"+e).html());t[e].summernote("code",a)},$(document).on("click",".cancel-comment",(function(e){var t=$(this).data("id");$(this).addClass("d-none"),$(".comment-display-"+t).removeClass("d-none"),$(".comment-edit-"+t).addClass("d-none"),$(".comment-save-icon-"+t).addClass("d-none")})),$(document).on("click",".save-comment",(function(e){var a=$(this).data("id"),i=t[a].summernote("code");if(t[a].summernote("isEmpty"))return!1;$.ajax({url:route("task.update-comment",[taskId,a]),type:"post",data:{comment:i.trim()},success:function(e){e.success&&function(e,t){$(".comment-display-"+e).html(t).removeClass("d-none"),$(".comment-edit-"+e).addClass("d-none"),$(".comment-save-icon-"+e).addClass("d-none"),$(".comment-cancel-icon-"+e).addClass("d-none")}(a,i)},error:function(e){printErrorMessage("#taskValidationErrorsBox",e)}})}));var a=$("#commentContainer").summernote({placeholder:"Add Comment...",minHeight:200,dialogsInBody:!0,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]],["insert",["link"]]]}),i=$("#taskEditDescription").summernote({placeholder:"Add Task description...",minHeight:200,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]]});$(document).on("click","#btnCancel",(function(){a.summernote("code",""),$("#btnComment").data("edit-mode",0),$("#btnComment").data("comment-id",0)})),$(".modal").modal({show:!1,backdrop:"static"}),$(document).on("change","#taskStatus",(function(){var e=$(this).data("id"),t="";t=0==$(this).prop("checked")?0:1,$.ajax({url:route("tasks.update-status",e),method:"PUT",data:{status:t},cache:!1,success:function(){location.reload()}})})),$(document).ready((function(){$("#editEstimateTimeHours").datetimepicker({format:"HH:mm",useCurrent:!1,locale:"ar"==languageName?"en":languageName,icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons",up:"icon-arrow-up icons",down:"icon-arrow-down icons"},sideBySide:!0}),$("#editEstimateTimeDays").hide(),$(document).on("click","#editHours",(function(){$("#editDays").removeClass("btn btn-primary text-white"),$(this).addClass("btn btn-primary text-white"),$("#editTypes").val(0),$("#editEstimateTimeDays").hide().val(""),$("#editEstimateTimeHours").show()})),$(document).on("click","#editDays",(function(){$("#editHours").removeClass("btn btn-primary text-white"),$(this).addClass("btn btn-primary text-white"),$("#editTypes").val(1),$("#editEstimateTimeHours").data("DateTimePicker").date("00:00"),$("#editEstimateTimeHours").hide().val(""),$("#editEstimateTimeDays").show()}))}))})();