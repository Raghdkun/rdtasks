(()=>{"use strict";for(var e,t=[],a=document.getElementsByClassName("board").length,n=0;n<a;n++)t.push(document.querySelector(".board-"+n));var o=dragula({containers:t,revertOnSpill:!0,direction:"vertical"}).on("drag",(function(e){e.className=e.className.replace("ex-moved","")})).on("drop",(function(t,a){var n=$(a);t.className+=" ex-moved",e=$(".ex-moved").data("id");var o=$(".ex-moved").data("task-status"),s=$(a).data("board-status");n.parent().find(".infy-loader").fadeIn(),$.ajax({url:route("tasks.update-status",e),type:"PUT",data:{task_status:o,status:s},cache:!1,complete:function(){n.parent().find(".infy-loader").fadeOut()}})})).on("over",(function(e,t){t.className+=" ex-over"})).on("out",(function(e,t){t.className=t.className.replace("ex-over","")}));$(document).ready((function(){var e=[document.querySelector(".flex-nowrap")];$(".board").each((function(t,a){e.push(document.querySelector(".board-"+t))}));autoScroll(e,{margin:200,autoScroll:function(){return this.down&&o.dragging}})})),$("#dueDate").datetimepicker({format:"YYYY-MM-DD",useCurrent:!1,locale:"ar"==languageName?"en":languageName,icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,minDate:moment().millisecond(0).second(0).minute(0).hour(0)}),$(document).on("click",".task-details",(function(e){e.preventDefault();var t=$(this);$(this).addClass("disabled");var a=$(this).attr("data-id");$.ajax({url:route("kanban-task-details",a),type:"get",success:function(e){e.success&&(r(e.data),$("#taskKanbanDetailsModel").modal("show"),scrollToTheBottomComment())},error:function(e){manageAjaxErrors(e)},complete:function(){t.removeClass("disabled")}})}));var s,r=function(e){var t=e.taskDetails,a=e.taskStatus,n=e.priority,o=e.users,s=[],r=[],i=[];s.push(t.task_assignee),r.push(t.comments),i.push(e.attachments);var d=$("#userId").val();if($("#taskId").val(t.id),$("#task_title").empty(),$("#task_title").append(t.title),$("#task_timer_card_16,#task_timer_all_card_16").append(roundToQuarterHourAll(t.task_total_minutes)),isEmpty(t.description)?$("#task_no_description").append("No description added yet."):$("#task_description").append(t.description),$("#start_date").append(moment(t.created_at).format("Do MMM, YYYY")),$("#status").append(prepareTemplateRender("#status-text",[{status:t.status_text}])),isEmpty(t.priority)?$("#priority").append(prepareTemplateRender("#priority-text",[{priority:"N/A"}])):$("#priority").append(prepareTemplateRender("#priority-text",[{priority:t.priority}])),$("#created_by").append(t.created_user.name),$("#created_date").append(moment(t.created_at).format("DD-MM-YYYY")),$("#project_id").append("#"+t.project.name).attr("href","user-assign-projects/"+t.project.id),$("#project_admin_id").append("#"+t.project.name).attr("href","projects/"+t.project.id),isEmpty(t.due_date)?$("#due_date").append(prepareTemplateRender("#edit-due-date",[{due_date:moment(moment()).format("Do MMM, YYYY")}])):$("#due_date").append(prepareTemplateRender("#edit-due-date",[{due_date:moment(t.due_date).format("Do MMM, YYYY")}])),$.each(a,(function(e,t){$("#popover-content-status").append('<div class="status popover-div cursor-pointer pl-2" id="'+e+'"><span>'+t+"</span></div>")})),$.each(n,(function(e,t){$("#popover-content-priority").append('<div class="priority popover-div cursor-pointer pl-2" id="'+e+'"><span>'+t+"</span></div>")})),$.each(o,(function(e,t){$("#popover-content-edit-assignee").append('<div class="edit-assignee popover-div cursor-pointer pl-1" id="'+e+'"><span>'+t+"</span></div>")})),0!==e.attachments.length)for(var c=0;i[0].length>c;c++){var p,m=e.attachments[c].name.split(".").pop(),u=[];u=e.attachments[c].url,"xlsx"!==m&&"xls"!==m&&"csv"!==m||(u="/assets/img/xls_icon.png"),"pdf"===m&&(u="/assets/img/pdf_icon.png"),"docx"!==m&&"doc"!==m||(u="/assets/img/doc_icon.png"),p=[{id:e.attachments[c].id,url:e.attachments[c].url,image:u,username:t.created_user.name,downloadTask:route("tasks.index"),updated_at:moment(t.attachments[c].updated_at).fromNow(),createdId:t.created_user.id,loginUserId:loggedInUserId}],$("#attachments").append(prepareTemplateRender("#attachment",p))}else $("#no_attachments").append("No attachments added yet").addClass("text-center");if(0!==t.comments.length)for(var l=0;r[0].length>l;l++){var h;h=[{id:t.comments[l].id,userImage:t.comments[l].created_user.img_avatar,userName:t.comments[l].created_user.name,comment:t.comments[l].comment,updated_at:moment(t.comments[l].updated_at).fromNow(),userId:t.comments[l].created_user.id,loginUserId:d}],$("#card-comments-container").append(prepareTemplateRender("#comment",h))}else $("#card-comments-container").append('<div class="text-center no-comment">No comments added yet</div>');for(var v=0;s[0].length>v;v++){var f;f=[{name:t.task_assignee[v].name,avatar:t.task_assignee[v].img_avatar,moreAssignee:s[0].length-6}],v<6?$("#task_assignee").append(prepareTemplateRender("#task-assignee",f)):v==s[0].length-1&&$("#task_assignee").append(prepareTemplateRender("#more-assignee",f))}""!=o&&$("#task_assignee").append(prepareTemplateRender("#add-assignee",[{id:t.id}]))};$("#taskKanbanDetailsModel").on("hide.bs.modal",(function(){return d.next().is(":visible")?(displayErrorMessage("Please Save Description"),!1):!$(".task-title-input").hasClass("error")&&void 0})),$("#taskKanbanDetailsModel").on("hidden.bs.modal",(function(){$(this).find("#task_title,#task_assignee,#task_description,#task_timer_card_16,#task_timer_all_card_16,#task_assignee,#start_date,#due_date,#status,#priority,#task_id,#created_by,#created_date,#project_id,#project_admin_id,#card-comments-container,#attachments,#task_no_description,#no_attachments,#popover-content-status,#popover-content-priority,#popover-content-edit-assignee").empty(),$(".btn-upload").hide(),$(".choose-button").show(),c.next().hide(),$("#btnCommentSave").hide(),$("#btnCommentClose").hide(),$(".comment-input").show(),window.livewire.emit("refresh")})),$(document).on("click","#task_title,.edit-title",(function(){s=$("#task_title").text(),$("#task_title").hide(),$(".edit-title").hide(),$("#task_title").prev("input").show().val(s).focus()})),$(document).on("blur",".task-title-input",(function(e){e.preventDefault();var t=$("#taskId").val(),a=$(this).val();if(""==a.trim())return $(this).addClass("error"),displayErrorMessage("Enter task name"),!1;$(this).removeClass("error"),$.ajax({url:route("kanban-task-details-update",t),type:"post",data:{title:a},success:function(e){$(".task-title-input").hide(),$(".edit-title").show(),$("#task_title").text(""),e.success&&$("#task_title").append(e.data.task.title).show()},error:function(e){manageAjaxErrors(e)}})}));var i,d=$(".description_input").summernote({placeholder:"Add Task Description...",minHeight:200,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]]});d.next().hide(),$(".btnDescription").hide(),$(document).on("click","#task_description,.task_edit_description",(function(){i=$("#task_description").html(),$("#task_description").hide(),$(".task_edit_description").hide(),$("#task_no_description").hide(),$(".btnDescription").show(),$(".description_input").summernote("code",i),d.next().addClass("border border-primary p-1 rounded").show(),$(".description_input").summernote({focus:!0})})),$(document).on("click",".btnDescription",(function(){var e=jQuery(this);e.button("loading");var t=$("#taskId").val(),a=$(".description_input").summernote("code"),n=""===$("<div />").html($(".description_input").summernote("code")).text().trim().replace(/ \r\n\t/g,"");if(""==d.summernote("code"))a=$(".description_input").summernote("code");else if(n)return displayErrorMessage("Description field is not contain only white space"),e.button("reset"),!1;$.ajax({url:route("kanban-task-details-update",t),type:"post",data:{description:a},success:function(e){d.next().hide(),$(".btnDescription").hide(),$(".task_edit_description").show(),$("#task_description").text(""),e.success&&($("#task_no_description").empty(),$("#task_description").append(e.data.task.description).show(),isEmpty(e.data.task.description)&&$("#task_no_description").append("No Description Added Yet").show())},error:function(e){manageAjaxErrors(e)},complete:function(){e.button("reset")}})}));var c=$("#comments-input").summernote({placeholder:"Add Comment...",minHeight:200,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]]});function p(e){e.preventDefault();var t=e.target.files,a=$("#taskId").val();t.length;for(var n=0;n<t.length;n++){var o=t[n].name.split(".").pop().toLowerCase();if(-1==$.inArray(o,["png","jpg","jpeg","xls","xlsx","csv","pdf","doc","docx"]))return displayErrorMessage("The attachment must be a file of type: jpeg, jpg, png, xls, xlsx, pdf, doc"),$(this).val(""),!1;if(t[n].size>1e6)return displayErrorMessage("The attachment size should not greater than 12 mb."),$(this).val(""),!1;var s=new FormData;s.append("file",t[n]),$.ajax({url:route("task.add-attachment",a),type:"post",data:s,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(e){var t=e.data;if(e.success){$("#no_attachments").empty();var a,n=t.file_name.split(".").pop(),o=[];o=t.file_url,"xlsx"!==n&&"xls"!==n&&"csv"!==n||(o="/assets/img/xls_icon.png"),"pdf"===n&&(o="/assets/img/pdf_icon.png"),"docx"!==n&&"doc"!==n||(o="/assets/img/doc_icon.png"),a=[{id:t.id,url:t.file_url,image:o,username:t.user,downloadTask:route("tasks.index"),updated_at:moment(t.updated_at).fromNow(),createdId:t.userId,loginUserId:loggedInUserId}],$("#attachments").append(prepareTemplateRender("#attachment",a))}scrollToTheBottomAttachment()},error:function(e){manageAjaxErrors(e)},complete:function(){}})}}c.next().hide(),$("#btnCommentSave").hide(),$("#btnCommentClose").hide(),$(document).on("click",".comment-input",(function(){$(this).hide(),c.next().addClass("border border-primary p-1 rounded").show(),$("#comments-input").summernote({focus:!0}),$("#btnCommentSave").show(),$("#btnCommentClose").show()})),$(document).on("click","#btnCommentClose",(function(){$(this).hide(),c.next().hide(),$("#btnCommentSave").hide(),$(".comment-input").show(),c.summernote("code",""),$("#btnCommentSave").data("edit-mode",0)})),window.scrollToTheBottomComment=function(){setTimeout((function(){var e=$("#card-comments-container").outerHeight();$(".comment-content").scrollTop(e*e)}),200)},$(document).on("click","#btnCommentSave",(function(){var e=jQuery(this);e.button("loading");var t=$(this);$(this).addClass("disabled");var a=c.summernote("code"),n=""===$("<div />").html($("#comments-input").summernote("code")).text().trim().replace(/ \r\n\t/g,""),o=$("#taskId").val(),s=$(this).data("comment-id"),r=$(this).data("edit-mode"),i=null,d=$("#userId").val();return c.summernote("isEmpty")?(displayErrorMessage("Please Enter comment"),t.removeClass("disabled"),e.button("reset"),!1):n?(displayErrorMessage("Comment is not contain only white space"),t.removeClass("disabled"),e.button("reset"),!1):(i=0===r?route("task.comments",o):route("task.update-comment",[o,s]),void $.ajax({url:i,type:"post",data:{comment:a},success:function(e){if(e.success)if(c.next().hide(),$("#btnCommentSave").hide(),$("#btnCommentClose").hide(),$(".no-comment").remove(),$(".comment-input").show(),c.summernote("code",""),0===r){var t,n=e.data.comment;t=[{id:n.id,userImage:n.created_user.img_avatar,userName:n.created_user.name,comment:n.comment,updated_at:moment(n.updated_at).fromNow(),userId:n.created_user.id,loginUserId:d}],scrollToTheBottomComment(),$("#card-comments-container").append(prepareTemplateRender("#comment",t))}else $(".comments-data"+s).html(a),$("#btnCommentSave").data("edit-mode",0),$("#btnCommentSave").data("comment-id",0)},error:function(e){printErrorMessage("#taskValidationErrorsBox",e)},complete:function(){t.removeClass("disabled"),e.button("reset")}}))})),$(document).on("click",".delete-comment",(function(){var e=$(this).data("id"),t=$("#taskId").val(),a=$(this).parent().parent().parent().parent().parent().parent().prop("id");swal({title:"Delete !",text:'Are you sure want to delete this "Comment" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777EF",cancelButtonColor:"#d33",cancelButtonText:"No",confirmButtonText:"Yes"},(function(){$.ajax({url:route("task.delete-comment",[t,e]),type:"DELETE",success:function(e){e.success&&($("#"+a).remove(),c.summernote("code",""),$("#btnCommentSave").data("edit-mode",0),$("#btnCommentSave").data("comment-id",0),$.trim($("#card-comments-container").html())||$("#card-comments-container").append('<div class="text-center no-comment">No comments added yet</div>')),swal({title:"Deleted!",text:"Comment has been deleted.",type:"success",confirmButtonColor:"#6777EF",timer:2e3})},error:function(e){swal({title:"",text:e.responseJSON.message,type:"error",confirmButtonColor:"#6777EF",timer:5e3})}})}))})),$(".close").on("click",(function(){$("#task_description").show(),$(".task_edit_description").show(),$("#task_no_description").show(),$(".btnDescription").hide(),d.next().removeClass("border border-primary p-1 rounded").hide(),$(".description_input").summernote({focus:!1}),$("#taskKanbanDetailsModel").modal("hide")})),$(document).on("click",".edit-comment",(function(){var e=$(this).data("id"),t=$.trim($(".comments-data"+e).html());c.next().show(),c.summernote("code",""),c.summernote("code",t),$(".comment-input").hide(),$("#btnCommentSave").show(),$("#btnCommentClose").show(),$("#btnCommentSave").data("edit-mode",1),$("#btnCommentSave").data("comment-id",e)})),window.scrollToTheBottomAttachment=function(){setTimeout((function(){var e=$("#card-attachments-container").outerHeight();$(".attachments-content").scrollTop(e*e)}),200)},document.addEventListener("DOMContentLoaded",(function(){document.querySelector("#upload_attachment").addEventListener("change",p,!1)}),!1),$(".btn-upload").hide(),$(document).on("click",".delete-attachment",(function(){var e=$(this).attr("data-id"),t=$("#taskId").val(),a=$(this).parent().parent().parent().parent().prop("id");swal({title:deleteHeading+" !",text:deleteMessage+' "'+deleteAttachment+'" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777EF",cancelButtonColor:"#d33",cancelButtonText:noMessages,confirmButtonText:yesMessages},(function(){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="_token"]').attr("content")},type:"post",url:route("task.delete-attachment",e),data:{filename:name,id:t},success:function(){swal({title:"Deleted!",text:"Attachment has been deleted.",type:"success",confirmButtonColor:"#6777EF",timer:2e3}),$("#"+a).remove(),$.trim($("#attachments").html())||$("#no_attachments").append("No attachments added yet").addClass("text-center")},error:function(e){manageAjaxErrors()}})}))})),$("#taskKanbanDetailsModel").on("show.bs.modal",(function(){$("#task_date_due").datetimepicker({format:"YYYY-MM-DD",useCurrent:!1,locale:"ar"==languageName?"en":languageName,icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,minDate:moment().millisecond(0).second(0).minute(0).hour(0),widgetPositioning:{horizontal:"right",vertical:"bottom"}}),$("#task_date_due").on("dp.show",(function(){$("[data-toggle=popover]").popover("hide")})),$("#status-data").popover({html:!0,title:prepareTemplateRender("#status-popover"),content:function(){return $("#popover-content-status").html()}}),$("#priority-data").popover({html:!0,title:prepareTemplateRender("#priority-popover"),content:function(){return $("#popover-content-priority").html()}}),$("#edit-task-assignee-data").popover({html:!0,title:prepareTemplateRender("#assignee-popover"),content:function(){return $("#popover-content-edit-assignee").html()}})})),$(document).on("click","#status",(function(){$("#priority-data").popover("hide"),$("#edit-task-assignee-data").popover("hide")})),$(document).on("click","#priority",(function(){$("#status-data").popover("hide"),$("#edit-task-assignee-data").popover("hide")})),$(document).on("click","#edit-task-assignee-data",(function(){$("#priority-data").popover("hide"),$("#status-data").popover("hide")})),$(document).on("click",".btn-close-status",(function(){$("#status-data").popover("hide")})),$(document).on("click",".btn-close-priority",(function(){$("#priority-data").popover("hide")})),$(document).on("click",".btn-close-assignee",(function(){$("#edit-task-assignee-data").popover("hide")})),$(document).on("dp.change","#task_date_due",(function(e){var t=$(this).val(),a=$("#taskId").val();$.ajax({url:route("kanban-task-details-update",a),type:"post",data:{due_date:t},success:function(e){$("#due_date").empty(),e.success&&$("#due_date").append(prepareTemplateRender("#edit-due-date",[{due_date:moment(e.data.task.due_date).format("Do MMM, YYYY")}])),$("#task_date_due").datetimepicker({format:"YYYY-MM-DD",useCurrent:!1,locale:"ar"==languageName?"en":languageName,icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,minDate:moment().millisecond(0).second(0).minute(0).hour(0),widgetPositioning:{horizontal:"right",vertical:"bottom"}}),$("#task_date_due").on("dp.show",(function(){$("[data-toggle=popover]").popover("hide")}))},error:function(e){manageAjaxErrors(e)}})})),$(document).on("click",".status",(function(){var e=$(this).attr("id"),t=$("#taskId").val();$("#status-data").popover("hide"),$.ajax({url:route("kanban-task-details-update",t),type:"post",data:{status:e},success:function(e){if($("#status").empty(),e.success){var t=e.data.task.status_text;$("#status").append(prepareTemplateRender("#status-text",[{status:t}]))}$("#status-data").popover({html:!0,title:prepareTemplateRender("#status-popover"),content:function(){return $("#popover-content-status").html()}})},error:function(e){manageAjaxErrors(e)}})})),$(document).on("click",".priority",(function(){var e=$(this).attr("id"),t=$("#taskId").val();$("#priority-data").popover("hide"),$.ajax({url:route("kanban-task-details-update",t),type:"post",data:{priority:e},success:function(e){if($("#priority").empty(),e.success){var t=e.data.task.priority;$("#priority").append(prepareTemplateRender("#priority-text",[{priority:t}]))}$("#priority-data").popover({html:!0,title:prepareTemplateRender("#priority-popover"),content:function(){return $("#popover-content-priority").html()}})},error:function(e){manageAjaxErrors(e)}})})),$(document).on("click",".edit-assignee",(function(){var e=$(this).attr("id"),t=$("#taskId").val();$("#edit-task-assignee-data").popover("hide"),$.ajax({url:route("kanban-task-details-update",t),type:"post",data:{user_id:e},success:function(e){$("#task_assignee").empty(),$("#popover-content-edit-assignee").empty();for(var t=e.data.task.task_assignee,a=e.data.users,n=0;t.length>n;n++){var o;o=[{name:t[n].name,avatar:t[n].img_avatar,moreAssignee:t.length-6}],n<6?$("#task_assignee").append(prepareTemplateRender("#task-assignee",o)):n==t.length-1&&$("#task_assignee").append(prepareTemplateRender("#more-assignee",o))}""!=a&&$("#task_assignee").append(prepareTemplateRender("#add-assignee",[{id:e.data.id}])),$.each(a,(function(e,t){$("#popover-content-edit-assignee").append('<div href="#" class="edit-assignee popover-div pl-1" id="'+e+'"><span>'+t+"</span></div>")})),$("#edit-task-assignee-data").popover({html:!0,title:prepareTemplateRender("#assignee-popover"),content:function(){return $("#popover-content-edit-assignee").html()}})},error:function(e){manageAjaxErrors(e)}})}));$(document).on("click",".task-details",(function(e){e.preventDefault(),$("#taskDetails").find(".infy-loader").show(),$("#taskDetails").modal("show");var t=$(this).data("id");$.ajax({url:route("task.kanban-edit",t),type:"get",success:function(e){e.success&&(!function(e){var t=$("#taskDetails");t.find("#taskId").val(e.id),t.find("#title").val(e.title),t.find("#dueDate").val(e.due_date);var a=document.createElement("textarea");a.innerHTML=isEmpty(e.description)?"N/A":e.description,t.find("#taskDescription").summernote("code",a.value)}(e.data),$("#taskDetails").find(".infy-loader").fadeOut())},error:function(e){manageAjaxErrors(e)}})})),$("#taskDetails").on("hidden.bs.modal",(function(){$(this).find("#title").val(""),$(this).find("#dueDate").val(""),$(this).find("#taskDescription").summernote("code",""),$(this).find("#taskDescription").val("")})),$(document).on("submit","#taskDetailsForm",(function(e){e.preventDefault();var t=$(this).find("#taskId").val(),a=($(this),$(this).serializeArray());jQuery(this).find("#btnTaskSave").button("loading"),$.ajax({url:route("task.kanban-edit",t),type:"post",data:a,success:function(e){e.success&&location.reload(!0)},error:function(e){manageAjaxErrors(e)}})})),$(document).ready((function(){$("#taskDescription").summernote({placeholder:"Add Task description...",minHeight:200,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]]})})),jQuery(document).ready((function(){if($(".cd-stretchy-nav").length>0){var e=$(".cd-stretchy-nav");e.each((function(){var e=$(this);e.find(".cd-nav-trigger").on("click",(function(t){t.preventDefault(),e.toggleClass("nav-is-visible")}))})),$(document).on("click",(function(t){!$(t.target).is(".cd-nav-trigger")&&!$(t.target).is(".cd-nav-trigger span")&&e.removeClass("nav-is-visible")}))}})),$(".subdropdown p").on("click",(function(e){$(this).parent(".dropdown").dropdown("toggle"),e.stopPropagation(),e.preventDefault()})),$(document).ready((function(){$("#projectDropdown").select2(),$("#usersDropdown").select2(),setTimeout((function(){$("#projectDropdown").trigger("change")}),100),$(document).on("change","#projectDropdown",(function(){$("#usersDropdown").empty();var e=$(this).val();$.ajax({url:route("users-by-project",e),type:"GET",success:function(e){if(e.success){var t=e.data;for(var a in $("#usersDropdown").find("option").remove().end().append('<option value="">All</option>'),t)t.hasOwnProperty(a)&&$("#usersDropdown").append($("<option>",{value:t[a],text:a}))}},error:function(e){null==$("#projectDropdown").val()?displayErrorMessage("User not have any projects"):manageAjaxErrors(e)}}),window.livewire.emit("loadByProject",$(this).val())})),loginUserRole?$(document).on("change","#usersDropdown",(function(){window.livewire.emit("loadByUser",$(this).val())})):($("#usersDropdown").val(authUserId).trigger("change"),window.livewire.emit("loadByUser",$("#loginUserId").val()))})),document.addEventListener("livewire:load",(function(){window.livewire.hook("message.processed",(function(){setTimeout((function(){$(document).find('[data-toggle="tooltip"]').tooltip("dispose"),$(document).find('[data-toggle="tooltip"]').tooltip()}),100)}))})),window.scrollToTheBottomAttachment=function(){setTimeout((function(){var e=$("#card-attachments-container-edit").outerHeight();$(".attachments-content-edit").scrollTop(e*e)}),200)}})();