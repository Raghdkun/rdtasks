(()=>{$(document).ready((function(){"use strict";$("#task_users").select2({width:"100%",placeholder:"All",minimumResultsForSearch:-1});var e=!0;$(document).on("click",".taskDetails",(function(t){var a=$(t.currentTarget).attr("data-id");$("#no-record-info-msg").hide(),$("#taskDetailsTable").hide(),$(".time-entry-data").hide(),startLoader(),e=!0,$.ajax({url:route("task.users",a),type:"GET",success:function(e){$("#task_users").empty(""),$("#task_users").attr("data-task_id",a);var t=new Option("All",0,!1,!1);$("#task_users").append(t).trigger("change"),$.each(e,(function(e,t){var n=new Option(t,e+"-"+a,!1,!1);$("#task_users").append(n)}))}})})),$(document).on("change","#task_users",(function(){var e=$(this).attr("data-task_id"),t=$(this).val().split("-"),a=0;t.length>1&&(e=t[1],a=t[0]);var n=route("task.get-details",e),s="?";0!==a&&(s="&",n=n+"?user_id="+a),""!=reportStartDate&&""!=reportEndDate&&(n=n+s+"start_time="+reportStartDate+"&end_time="+reportEndDate),$.ajax({url:n,type:"GET",success:function(e){if(e.success){var t=e.data,a=taskUrl+t.project.prefix+"-"+t.task_number;$("#task-heading").html("<h5>Task: <a href='"+a+"' class='task-time-entry-heading-color'>"+t.title+"</a></h5>"),drawTaskDetailTable(t)}},error:function(e){stopLoader()}})})),window.drawTaskDetailTable=function(t){if(0===t.totalDuration&&e)return $("#no-record-info-msg").show(),$(".time-entry-data").hide(),stopLoader(),!0;e=!1;var a=$("#taskDetailsTable").DataTable({language:{paginate:{previous:'<i class="fas fa-angle-left"></i>',next:'<i class="fas fa-angle-right"></i>'}},destroy:!0,paging:!0,data:t.time_entries,searching:!1,lengthChange:!1,columns:[{className:"details-control",defaultContent:"<a class='btn btn-success collapse-icon action-btn btn-sm'><span class='fa fa-plus-circle action-icon'></span></a>",data:null,orderable:!1},{data:"user.name"},{data:"start_time"},{data:"end_time"},{data:function(e){return roundToQuarterHourAll(e.duration)}},{orderable:!1,data:function(e){return"<a title='Edit' class='btn action-btn btn-warning btn-sm mr-1' onclick='renderTimeEntry("+e.id+")' ><i class='fas fa-pencil-alt action-icon'></i></a><a title='Delete' class='btn action-btn btn-danger btn-sm'  onclick='deleteTimeEntry("+e.id+")'><i class='fas fa-trash action-icon'></i></a>"},visible:taskDetailActionColumnIsVisible}]});$("#taskDetailsTable th:first").removeClass("sorting_asc"),$(".time-entry-data").show(),$("#taskDetailsTable").show(),$("#user-drop-down-body").show(),$("#no-record-info-msg").hide(),stopLoader(),$("#taskDetailsTable tbody").off("click","tr td.details-control"),$("#taskDetailsTable tbody").on("click","tr td.details-control",(function(){var e=$(this).closest("tr"),t=a.row(e);t.child.isShown()?($(this).children().children().removeClass("fa-minus-circle").addClass("fa-plus-circle"),t.child.hide(),e.removeClass("shown")):($(this).children().children().removeClass("fa-plus-circle").addClass("fa-minus-circle"),t.child('<div class="padding-left-50px">'+nl2br(t.data().note)+"</div>").show(),e.addClass("shown"))})),$("#taskDetailsTable_wrapper").css("width","100%"),$("#total-duration").html("<strong>Total duration: "+t.totalDuration+" || "+t.totalDurationMin+" Minutes</strong>")},$(document).on("click",".taskDetails",(function(){$("#taskDetailsModal").appendTo("body").modal("show")}))})),$(document).on("click",".task-details",(function(t){t.preventDefault();var a=$(this);$(this).addClass("disabled");var n=$(this).attr("data-id");$.ajax({url:route("kanban-task-details",n),type:"get",success:function(t){t.success&&(e(t.data),$("#taskKanbanDetailsModel").appendTo("body").modal("show"),scrollToTheBottomComment())},error:function(e){manageAjaxErrors(e)},complete:function(){a.removeClass("disabled")}})}));var e=function(e){var t=e.taskDetails,a=e.taskStatus,n=e.priority,s=e.users,o=[],r=[],i=[];o.push(t.task_assignee),r.push(t.comments),i.push(e.attachments);var d=$("#userId").val();if($("#taskId").val(t.id),$("#ThisTaskId").val(t.id),$("#task_title").empty(),$("#task_title").append(t.title),$("#task_timer_card_16,#task_timer_all_card_16").append(roundToQuarterHourAll(t.task_total_minutes)),isEmpty(t.description)?$("#task_no_description").append("No description added yet."):$("#task_description").append(t.description),$("#start_date").append(moment(t.created_at).format("Do MMM, YYYY")),$("#status").append(prepareTemplateRender("#status-text",[{status:t.status_text}])),isEmpty(t.priority)?$("#taskDetailsPriority").append(prepareTemplateRender("#priority-text",[{priority:"N/A"}])):$("#taskDetailsPriority").append(prepareTemplateRender("#priority-text",[{priority:t.priority}])),$("#created_by").append(t.created_user.name),$("#created_date").append(moment(t.created_at).format("DD-MM-YYYY")),$("#project_id").append("#"+t.project.name).attr("href","user-assign-projects/"+t.project.id),$("#project_admin_id").append("#"+t.project.name).attr("href","projects/"+t.project.id),isEmpty(t.due_date)?$("#due_date").append(prepareTemplateRender("#edit-due-date",[{due_date:moment(moment()).format("Do MMM, YYYY")}])):$("#due_date").append(prepareTemplateRender("#edit-due-date",[{due_date:moment(t.due_date).format("Do MMM, YYYY")}])),$.each(a,(function(e,t){$("#popover-content-status").append('<div class="status popover-div cursor-pointer pl-2" id="'+e+'"><span>'+t+"</span></div>")})),$.each(n,(function(e,t){$("#popover-content-priority").append('<div class="priority popover-div cursor-pointer pl-2" id="'+e+'"><span>'+t+"</span></div>")})),$.each(s,(function(e,t){$("#popover-content-edit-assignee").append('<div class="edit-assignee popover-div cursor-pointer pl-1" id="'+e+'"><span>'+t+"</span></div>")})),0!==e.attachments.length)for(var c=0;i[0].length>c;c++){var m,l=e.attachments[c].name.split(".").pop(),p=[];p=e.attachments[c].url,"xlsx"!==l&&"xls"!==l&&"csv"!==l||(p="/assets/img/xls_icon.png"),"pdf"===l&&(p="/assets/img/pdf_icon.png"),"docx"!==l&&"doc"!==l||(p="/assets/img/doc_icon.png"),m=[{id:e.attachments[c].id,url:e.attachments[c].url,image:p,username:t.created_user.name,downloadTask:route("tasks.index"),updated_at:moment(t.attachments[c].updated_at).fromNow(),createdId:t.created_user.id,loginUserId:loggedInUserId}],$("#attachments").append(prepareTemplateRender("#attachment",m))}else $("#no_attachments").append("No attachments added yet").addClass("text-center");if(0!==t.comments.length)for(var u=0;r[0].length>u;u++){var h;h=[{id:t.comments[u].id,userImage:t.comments[u].created_user.img_avatar,userName:t.comments[u].created_user.name,comment:t.comments[u].comment,updated_at:moment(t.comments[u].updated_at).fromNow(),userId:t.comments[u].created_user.id,loginUserId:d}],$("#card-comments-container").append(prepareTemplateRender("#comment",h))}else $("#card-comments-container").append('<div class="text-center no-comment">No comments added yet</div>');for(var f=0;o[0].length>f;f++){var v;v=[{name:t.task_assignee[f].name,avatar:t.task_assignee[f].img_avatar,moreAssignee:o[0].length-6}],f<6?$("#task_assignee").append(prepareTemplateRender("#task-assignee",v)):f==o[0].length-1&&$("#task_assignee").append(prepareTemplateRender("#more-assignee",v))}};window.scrollToTheBottomComment=function(){setTimeout((function(){var e=$("#card-comments-container").outerHeight();$(".comment-content").scrollTop(e*e)}),200)},$(document).on("click","#btnCommentSave",(function(){var e=jQuery(this);e.button("loading");var a=$(this);$(this).addClass("disabled");var n=t.summernote("code"),s=""===$("<div />").html($("#comments-input").summernote("code")).text().trim().replace(/ \r\n\t/g,""),o=$("#taskId").val();null==o&&(o=$("#ThisTaskId").val());var r=$(this).data("comment-id"),i=$(this).data("edit-mode"),d=null,c=$("#userId").val();return t.summernote("isEmpty")?(displayErrorMessage("Please Enter comment"),a.removeClass("disabled"),e.button("reset"),!1):s?(displayErrorMessage("Comment is not contain only white space"),a.removeClass("disabled"),e.button("reset"),!1):(d=0===i?route("task.comments",o):route("task.update-comment",[o,r]),void $.ajax({url:d,type:"post",data:{comment:n},success:function(e){if(e.success)if(t.next().hide(),$("#btnCommentSave").hide(),$("#btnCommentClose").hide(),$(".no-comment").remove(),$(".comment-input").show(),t.summernote("code",""),0===i){var a,s=e.data.comment;a=[{id:s.id,userImage:s.created_user.img_avatar,userName:s.created_user.name,comment:s.comment,updated_at:moment(s.updated_at).fromNow(),userId:s.created_user.id,loginUserId:c}],scrollToTheBottomComment(),$("#card-comments-container").append(prepareTemplateRender("#comment",a))}else $(".comments-data"+r).html(n),$("#btnCommentSave").data("edit-mode",0),$("#btnCommentSave").data("comment-id",0)},error:function(e){printErrorMessage("#taskValidationErrorsBox",e)},complete:function(){a.removeClass("disabled"),e.button("reset")}}))})),$(document).on("click",".delete-comment",(function(){var e=$(this).data("id"),a=$("#taskId").val(),n=$(this).parent().parent().parent().parent().parent().parent().prop("id");swal({title:"Delete !",text:'Are you sure want to delete this "Comment" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777EF",cancelButtonColor:"#d33",cancelButtonText:"No",confirmButtonText:"Yes"},(function(){$.ajax({url:route("task.delete-comment",[a,e]),type:"DELETE",success:function(e){e.success&&($("#"+n).remove(),t.summernote("code",""),$("#btnCommentSave").data("edit-mode",0),$("#btnCommentSave").data("comment-id",0),$.trim($("#card-comments-container").html())||$("#card-comments-container").append('<div class="text-center no-comment">No comments added yet</div>')),swal({title:"Deleted!",text:"Comment has been deleted.",type:"success",confirmButtonColor:"#6777EF",timer:2e3})},error:function(e){swal({title:"",text:e.responseJSON.message,type:"error",confirmButtonColor:"#6777EF",timer:5e3})}})}))})),$(".btn-upload").hide();var t=$("#comments-input").summernote({placeholder:"Add Comment...",minHeight:200,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]]});function a(e){e.preventDefault();var t=e.target.files,a=$("#ThisTaskId").val();""==a&&(a=$("#tagId").val()),t.length;for(var n=0;n<t.length;n++){var s=t[n].name.split(".").pop().toLowerCase();if(-1==$.inArray(s,["png","jpg","jpeg","xls","xlsx","csv","pdf","doc","docx"]))return displayErrorMessage("The attachment must be a file of type: jpeg, jpg, png, xls, xlsx, pdf, doc"),$(this).val(""),!1;if(t[n].size>1e6)return displayErrorMessage("The attachment size should not greater than 12 mb."),$(this).val(""),!1;var o=new FormData;o.append("file",t[n]),$.ajax({url:route("task.add-attachment",a),type:"post",data:o,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(e){var t=e.data;if(e.success){$("#no_attachments").empty();var a,n=t.file_name.split(".").pop(),s=[];s=t.file_url,"xlsx"!==n&&"xls"!==n&&"csv"!==n||(s="/assets/img/xls_icon.png"),"pdf"===n&&(s="/assets/img/pdf_icon.png"),"docx"!==n&&"doc"!==n||(s="/assets/img/doc_icon.png"),a=[{id:t.id,url:t.file_url,image:s,username:t.user,downloadTask:route("tasks.index"),updated_at:moment(t.updated_at).fromNow(),createdId:t.userId,loginUserId:loggedInUserId}],$("#attachments").append(prepareTemplateRender("#attachment",a))}scrollToTheBottomAttachment()},error:function(e){manageAjaxErrors(e)},complete:function(){}})}}t.next().hide(),$("#btnCommentSave").hide(),$("#btnCommentClose").hide(),$(document).on("click",".comment-input",(function(){$(this).hide(),t.next().addClass("border border-primary p-1 rounded").show(),$("#comments-input").summernote({focus:!0}),$("#btnCommentSave").show(),$("#btnCommentClose").show()})),$(document).on("click",".edit-comment",(function(){var e=$(this).data("id"),a=$.trim($(".comments-data"+e).html());t.next().show(),t.summernote("code",""),t.summernote("code",a),$(".comment-input").hide(),$("#btnCommentSave").show(),$("#btnCommentClose").show(),$("#btnCommentSave").data("edit-mode",1),$("#btnCommentSave").data("comment-id",e)})),$("#taskKanbanDetailsModel").on("hidden.bs.modal",(function(){$(this).find("#task_title,#task_assignee,#task_description,#task_timer_card_16,#task_timer_all_card_16,#task_assignee,#start_date,#due_date,#status,#taskDetailsPriority,#task_id,#created_by,#created_date,#project_id,#project_admin_id,#card-comments-container,#attachments,#task_no_description,#no_attachments,#popover-content-status,#popover-content-priority,#popover-content-edit-assignee").empty(),$(".btn-upload").hide(),$(".choose-button").show(),t.next().hide(),$("#btnCommentSave").hide(),$("#btnCommentClose").hide(),$(".comment-input").show(),window.livewire.emit("refresh")})),document.addEventListener("DOMContentLoaded",(function(){document.querySelector("#upload_attachment").addEventListener("change",a,!1)}),!1),$(".btn-upload").hide(),$(document).on("click",".delete-attachment",(function(){var e=$(this).attr("data-id"),t=$("#taskId").val(),a=$(this).parent().parent().parent().parent().prop("id");swal({title:deleteHeading+" !",text:deleteMessage+' "'+deleteAttachment+'" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777EF",cancelButtonColor:"#d33",cancelButtonText:noMessages,confirmButtonText:yesMessages},(function(){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="_token"]').attr("content")},type:"post",url:route("task.delete-attachment",e),data:{filename:name,id:t},success:function(){swal({title:"Deleted!",text:"Attachment has been deleted.",type:"success",confirmButtonColor:"#6777EF",timer:2e3}),$("#"+a).remove(),$.trim($("#attachments").html())||$("#no_attachments").append("No attachments added yet").addClass("text-center")},error:function(e){manageAjaxErrors()}})}))})),window.scrollToTheBottomAttachment=function(){setTimeout((function(){var e=$("#card-attachments-container").outerHeight();$(".attachments-content").scrollTop(e*e)}),200)},$(document).on("click","#btnCommentClose",(function(){$(this).hide(),t.next().hide(),$("#btnCommentSave").hide(),$(".comment-input").show(),t.summernote("code",""),$("#btnCommentSave").data("edit-mode",0)}))})();