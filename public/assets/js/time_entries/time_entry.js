(()=>{function e(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}$(document).ready((function(){"use strict";$('a[data-toggle="tab"]').on("shown.bs.tab",(function(e){localStorage.setItem("activeTab",$(e.target).attr("href"))}));var t=localStorage.getItem("activeTab");t&&($('.nav-tabs a[href="'+t+'"]').tab("show"),localStorage.removeItem("activeTab")),"undefined"==typeof isTask&&$("#taskId,#editTaskId").select2({width:"100%",placeholder:"Select Task"}),$("#duration").prop("disabled",!0),$("#timeProjectId,#editTimeProjectId").select2({width:"100%",placeholder:"Select Project"}),$("#filterUser,#filter_project").select2(),$("#filterActivity").select2({width:"150px"}),$("#activityTypeId,#editActivityTypeId").select2({width:"100%",placeholder:"Select Activity Type"}),$("#timeUserId,#editTimeUserId").select2({width:"100%",placeholder:"Select User"});var a,i=!1,n=null;if(isShow){var r,o=$("#time_range"),s="ar"==languageName?moment().lang("en"):moment(),d=s.clone().startOf("month"),c=s.clone().endOf("month"),m=($("#filterUser").val(),moment().startOf("month").subtract(1,"days"));$(document).ready((function(){"ar"==languageName?o.val(d.lang("en").format("YYYY-MM-DD")+" - "+c.lang("en").format("YYYY-MM-DD")):o.val(d.format("YYYY-MM-DD")+" - "+c.format("YYYY-MM-DD")),l.ajax.reload()})),window.cb=function(e,t){e._isValid&&t._isValid?"ar"==languageName?o.find("span").html(e.lang("en").format("MMM D, YYYY")+" - "+t.lang("en").format("MMM D, YYYY")):o.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY")):(o.val(""),o.find("span").html(""))},cb(d,c),o.daterangepicker({startDate:d,endDate:c,opens:"left",showDropdowns:!0,autoUpdateInput:!1,locale:{customRangeLabel:Lang.get("messages.common.custom"),applyLabel:Lang.get("messages.common.apply"),cancelLabel:Lang.get("messages.common.cancel"),fromLabel:Lang.get("messages.common.from"),toLabel:Lang.get("messages.common.to"),monthNames:[Lang.get("messages.months.jan"),Lang.get("messages.months.feb"),Lang.get("messages.months.mar"),Lang.get("messages.months.apr"),Lang.get("messages.months.may"),Lang.get("messages.months.jun"),Lang.get("messages.months.jul"),Lang.get("messages.months.aug"),Lang.get("messages.months.sep"),Lang.get("messages.months.oct"),Lang.get("messages.months.nov"),Lang.get("messages.months.dec")],daysOfWeek:[Lang.get("messages.weekdays.sun"),Lang.get("messages.weekdays.mon"),Lang.get("messages.weekdays.tue"),Lang.get("messages.weekdays.wed"),Lang.get("messages.weekdays.thu"),Lang.get("messages.weekdays.fri"),Lang.get("messages.weekdays.sat")]},ranges:(r={},e(r,Lang.get("messages.days.today"),[moment(),moment()]),e(r,Lang.get("messages.days.this_week"),[moment().startOf("week"),moment().endOf("week")]),e(r,Lang.get("messages.days.last_week"),[moment().startOf("week").subtract(7,"days"),moment().startOf("week").subtract(1,"days")]),e(r,Lang.get("messages.days.this_month"),[d,c]),e(r,Lang.get("messages.days.last_month"),[m.clone().startOf("month"),m.clone().endOf("month")]),r)},cb),o.on("apply.daterangepicker",(function(e,t){t.startDate._isValid&&t.endDate._isValid?("ar"==languageName?$(this).val(t.startDate.lang("en").format("YYYY-MM-DD")+" - "+t.endDate.lang("en").format("YYYY-MM-DD")):$(this).val(t.startDate.format("YYYY-MM-DD")+" - "+t.endDate.format("YYYY-MM-DD")),l.ajax.reload()):($(this).val(""),l.ajax.reload())}));var l=$("#taskTimeEntryTable").DataTable({language:{paginate:{previous:'<i class="fas fa-angle-left"></i>',next:'<i class="fas fa-angle-right"></i>'}},processing:!0,serverSide:!0,order:[[6,"desc"]],ajax:{url:route("task-time-entry"),data:function(e){e.filter_activity=$("#filterActivity").find("option:selected").val(),e.filter_date=o.val(),e.taskID=taskId}},columnDefs:[{targets:[7],orderable:!1},{targets:[2,3],className:"column-width",width:"15%"},{targets:[0],width:"5%"},{targets:[4],className:"text-center",width:"10%"},{targets:[5],className:"text-center",width:"8%"},{targets:[7],orderable:!1,className:"text-center",width:"8%"},{targets:[6],width:"11%"}],columns:[{className:"details-control",data:function(e){var t=moment().subtract(0,"days").format("DD-MM-YYYY"),a="N/A"==e.note?"empty-details":"",i=moment(e.created_at).format("DD-MM-YYYY");return"<a class='btn  btn-success collapse-icon action-btn btn-sm "+("N/A"==e.note&&i==t?" today-notice ":"")+a+"'><span class='fa fa-plus-circle action-icon'></span></a>"},orderable:!1,searchable:!1},{data:function(e){var t=document.createElement("textarea");return t.innerHTML=e.activity_type.name,t.value},name:"activityType.name"},{data:"start_time",name:"start_time"},{data:"end_time",name:"end_time"},{data:function(e){return roundToQuarterHourAll(e.duration)},name:"duration"},{data:function(e){return e},render:function(e){return 1==e.entry_type?'<span class="badge badge-primary">'+e.entry_type_string+"</span>":'<span class="badge badge-light">'+e.entry_type_string+"</span>"},name:"entry_type"},{data:function(e){return e},render:function(e){return'<span data-toggle="tooltip" title="'+format(e.created_at,"hh:mm:ss a")+'">'+format(e.created_at)+"</span>"},name:"created_at"},{data:function(e){return'<a title="Edit" class="btn-edit editTaskTimeEntry task-time-entry-action mr-1" data-id="'+e.id+'" data-project-id="'+e.task.project_id+'"><i class="fas fa-edit mr-0 card-edit-icon"></i></a><a title="Delete" class="btn-delete cursor task-time-entry-action" data-id="'+e.id+'" ><i class="fas fa-trash card-delete-icon"></i></a>'},name:"id"}],fnInitComplete:function(){$("#filterActivity").change((function(){l.ajax.reload()}))},drawCallback:function(){$(".empty-details").length?$("div.notice").html('<i class="fa fa-circle pr-1"></i><b>The Description Is Missing</b>').show():$("div.notice").html('<i class="fa fa-circle pr-1"></i><b>The Description Is Missing</b>').hide()}});$("#taskTimeEntryTable tbody").off("click","tr td.details-control"),$("#taskTimeEntryTable tbody").on("click","tr td.details-control",(function(){var e=$(this).closest("tr"),t=l.row(e),a=document.createElement("textarea");a.innerHTML=t.data().note,t.child.isShown()?($(this).children().children().removeClass("fa-minus-circle").addClass("fa-plus-circle"),t.child.hide(),e.removeClass("shown")):($(this).children().children().removeClass("fa-plus-circle").addClass("fa-minus-circle"),t.child('<div class="padding-left-80px">'+nl2br(a.value)+"</div>").show(),e.addClass("shown"))}))}$("#timeEntryTable").on("draw.dt",(function(){$('[data-toggle="tooltip"]').tooltip()})),$(document).on("click",".addNewTimeEntry",(function(){$("#timeEntryAddModal").appendTo("body").modal("show")}));var u=!0;$(document).on("submit","#timeEntryAddForm",(function(e){if(e.preventDefault(),$("#taskId").removeAttr("disabled",!1),$("#timeUserId").prop("disabled",!1),$("#timeProjectId").prop("disabled",!1),canManageEntries&&!u&&isEmpty($("#timeUserId").val()))return displayErrorMessage(loginUserName+" is not assigned to the task."),$("#timeUserId").prop("disabled",!0),$("#taskId").prop("disabled",!0),$("#timeProjectId").prop("disabled",!0),!1;var t=jQuery(this).find("#btnSave");t.button("loading"),$.ajax({url:route("time-entries.store"),type:"POST",data:$(this).serialize(),success:function(e){e.success&&($("#timeEntryAddModal").modal("hide"),displaySuccessMessage("Time Entry created successfully."),$("#timeEntryTable").DataTable().ajax.reload(null,!1),$("#taskTimeEntryTable").DataTable().ajax.reload(null,!1),URL.length<7&&window.livewire.emit("refresh"))},error:function(e){printErrorMessage("#tmAddValidationErrorsBox",e),u||($("#timeUserId").prop("disabled",!0),$("#timeProjectId").prop("disabled",!0),$("#taskId").prop("disabled",!0))},complete:function(){t.button("reset")}})})),$("#timeEntryAddModal").on("hidden.bs.modal",(function(){i=!1,$("#startTime").data("DateTimePicker").date(null),$("#endTime").data("DateTimePicker").date(null),$("#taskId").val("").trigger("change"),$("#timeUserId").val("").trigger("change"),$("#activityTypeId").val("").trigger("change"),$("#duration").prop("disabled",!1),$("#startTime").prop("disabled",!1),$("#endTime").prop("disabled",!1),$("#timeUserId").prop("disabled",!1),$("#timeProjectId").prop("disabled",!1),$("#taskId").prop("disabled",!1),resetModalForm("#timeEntryAddForm","#tmAddValidationErrorsBox")})),$("#startTime,#endTime").on("dp.change",(function(){var e=$("#startTime").val(),t=$("#endTime").val(),a=0;t&&(a=new Date(Date.parse(t)-Date.parse(e))/6e4,Number.isInteger(a)||(a=a.toFixed(2)));$("#duration").val(a).prop("disabled",!0)})),$("#startTime").attr("placeholder","YYYY-MM-DD HH:MM:SS"),$("#endTime").attr("placeholder","YYYY-MM-DD HH:MM:SS"),$(document).on("click","#dvStartTime,#dvEndTime",(function(){$("#startTime").removeAttr("disabled"),$("#endTime").removeAttr("disabled"),$("#duration").prop("disabled",!0)})),$("#editStartTime,#editEndTime").on("dp.change",(function(){var e=$("#editStartTime").val(),t=$("#editEndTime").val(),a=0;t&&(a=new Date(Date.parse(t)-Date.parse(e))/6e4,Number.isInteger(a)||(a=a.toFixed(2)));$("#editDuration").val(a).prop("disabled",!0),$("#editStartTime").data("DateTimePicker").maxDate(moment().endOf("now")),$("#editEndTime").data("DateTimePicker").maxDate(moment().endOf("now"))})),$("#startTime,#editStartTime").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!0,locale:"ar"==languageName?"en":languageName,icons:{up:"icon-arrow-up icons",down:"icon-arrow-down icons",previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,maxDate:moment().endOf("day"),widgetPositioning:{horizontal:"left",vertical:"bottom"}}),$("#endTime").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!0,locale:"ar"==languageName?"en":languageName,icons:{up:"icon-arrow-up icons",down:"icon-arrow-down icons",previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,maxDate:moment().endOf("day"),widgetPositioning:{horizontal:"left",vertical:"bottom"}}),$("#editEndTime").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!0,locale:"ar"==languageName?"en":languageName,icons:{up:"icon-arrow-up icons",down:"icon-arrow-down icons",previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,maxDate:moment().endOf("day"),widgetPositioning:{horizontal:"left",vertical:"bottom"}}),$("#startTime, #editStartTime, #endTime, #editEndTime").on("dp.show",(function(){matchWindowScreenPixels({startTime:"#startTime",editStartTime:"#editStartTime",endTime:"#endTime",editEndTime:"#editEndTime"},"tsk")})),$(window).resize((function(){matchWindowScreenPixels({startTime:"#startTime",editStartTime:"#editStartTime",endTime:"#endTime",editEndTime:"#editEndTime"},"tsk")})).trigger("resize"),$("#startTime,#endTime").on("dp.change",(function(e){$("#startTime").data("DateTimePicker").maxDate(moment().endOf("now")),$("#endTime").data("DateTimePicker").maxDate(moment().endOf("now"))})),$(document).on("submit","#editTimeEntryForm",(function(e){if(e.preventDefault(),$("#editTimeUserId").prop("disabled",!1),$("#editTimeProjectId").prop("disabled",!1),$("#editTaskId").prop("disabled",!1),canManageEntries&&loginUserAdmin&&isEmpty($("#editTimeUserId").val()))return displayErrorMessage("Please select user."),$("#editTimeUserId").prop("disabled",!0),!1;var t=jQuery(this).find("#btnEditSave");t.button("loading");var a=$("#entryId").val();$.ajax({url:route("time-entries.update",a),type:"put",data:$(this).serialize(),success:function(e){e.success&&($("#editTimeEntryModal").modal("hide"),displaySuccessMessage("Time Entry updated successfully."),$("#taskTimeEntryTable").DataTable().ajax.reload(null,!1),$.isFunction(window.taskDetails)&&taskDetails(e.data.task_id))},error:function(e){manageAjaxErrors(e,"teEditValidationErrorsBox"),$("#editTimeUserId").prop("disabled",!0),$("#editTimeProjectId").prop("disabled",!0),$("#editTaskId").prop("disabled",!0)},complete:function(){t.button("reset")}})})),$("#editTimeEntryModal").on("hidden.bs.modal",(function(){$("#editDuration").prop("disabled",!1),$("#editStartTime").prop("disabled",!1),$("#editEndTime").prop("disabled",!1),resetModalForm("#editTimeEntryForm","#teEditValidationErrorsBox")}));var g="";window.renderTimeEntry=function(e){$.ajax({url:route("time-entries.edit",e),type:"GET",success:function(e){if(e.success){var t=e.data,i=document.createElement("textarea");i.innerHTML=t.note,g=t.user_id,a=t.task_id,n=t.project_id,$("#entryId").val(t.id),$("#editTimeProjectId").val(t.project_id).trigger("change"),$("#editActivityTypeId").val(t.activity_type_id).trigger("change"),$("#editDuration").val(t.duration),$("#editStartTime").val(t.start_time),$("#editEndTime").val(t.end_time),$("#editNote").val(i.value),$("#editTimeEntryModal").appendTo("body").modal("show"),$("#editTimeUserId").prop("disabled",!0),$("#editTimeProjectId").prop("disabled",!0),setTimeout((function(){$("#editTaskId").val(a).trigger("change.select2"),$("#editTaskId").prop("disabled",!1)}),1e3),setTimeout((function(){$("#editTimeUserId").val(t.user_id).trigger("change.select2")}),1e3)}},error:function(e){displayErrorMessage(e.responseJSON.message),manageAjaxErrors(e,"teEditValidationErrorsBox")}})},$(document).on("click",".btn-edit",(function(e){var t=$(e.currentTarget).attr("data-id");renderTimeEntry(t)})),$(document).on("click",".btn-delete",(function(e){var t=$(e.currentTarget).attr("data-id");deleteItem(route("time-entries.destroy",t),"#timeEntryTable","Time Entry")})),$(document).on("click",".btn-task-time-note",(function(e){var t=$(e.currentTarget).attr("data-id");$.ajax({url:route("showTimeEntryNote",t),type:"GET",success:function(e){if(e.success){if($("#showNote").html(""),isEmpty(e.data.note))$("#showNote").append("N/A");else{var t=document.createElement("textarea");t.innerHTML=e.data.note,$("#showNote").append(t.value.replace(/\n/g,"<br/>"))}$("#showModal").appendTo("body").modal("show")}},error:function(e){displayErrorMessage(e.responseJSON.message)}})})),window.getTasksByProject=function(e,t,n,r){if(!(e>0))return!1;var o=route("project-tasks",e);o=isEmpty(g)?i?o+"?task_id="+a:o:i?o+"?task_id="+a:o+"?user_id="+g,$.ajax({url:o,type:"get",success:function(e){var a=e.data;if(n>0)var i='<option value="0" disabled>Select Task</option>';else i='<option value="0" disabled selected>Select Task</option>';$.each(a,(function(e,t){i+=(n=e)>0&&n==e?'<option value="'+e+'" selected>'+t+"</option>":'<option value="'+e+'">'+t+"</option>"})),$(t).html(i),n>0&&$(t).val(n).trigger("change")},error:function(e){printErrorMessage(r,e)}})},$("#timeProjectId").on("change",(function(){$("#taskId").select2("val","");var e=$(this).val();getTasksByProject(e,"#taskId",0,"#tmAddValidationErrorsBox")})),$("#editTimeProjectId").on("change",(function(){$("#editTaskId").select2("val","");var e=$(this).val();i=n==e,getTasksByProject(e,"#editTaskId",0,"#teEditValidationErrorsBox")})),$(document).on("click","#new_entry",(function(){var e=localStorage.getItem("project_id");$("#timeProjectId").val(e),$("#timeProjectId").trigger("change"),getTasksByProject(e,"#taskId",0,"#tmAddValidationErrorsBox"),$("#endTime").val(moment().format("YYYY-MM-DD HH:mm:ss"))})),$(document).on("click","#copyTodayEntry",(function(){screenLock(),$.ajax({url:route("copy-today-activity"),type:"get",success:function(e){var t=document.createElement("textarea");t.innerHTML=e,copyTextToClipBoard(t.value),swal({title:"Copied",text:"Time Entries copied to clipboard.",type:"success",timer:3e3,confirmButtonColor:"#6777EF"}),screenUnLock()},error:function(e){printErrorMessage("#tmValidationErrorsBox",e)}})})),window.copyTextToClipBoard=function(e){var t=document.createElement("textarea");document.body.appendChild(t),t.textContent=e,t.select(),document.execCommand("copy"),t.remove()},window.getProjectsByUser=function(e,t,a,i,n){if(!(e>0))return!1;$.ajax({url:route("users-project",e),type:"get",success:function(e){var n=e.data,r='<option value="0" disabled selected>Select Project</option>';i>0&&(r='<option value="0" disabled>Select Project</option>'),$.each(n,(function(e,t){r+=i>0&&i==e?'<option value="'+e+'" selected>'+t+"</option>":'<option value="'+e+'">'+t+"</option>"})),$(t).html(r),$(a).html(""),i>0&&$(t).val(i).trigger("change")},error:function(e){printErrorMessage(n,e)}})},$("#timeUserId").on("change",(function(){$("#taskId").select2("val",""),$("#timeProjectId").select2("val","");var e=$(this).val();g=$(this).val(),getProjectsByUser(e,"#timeProjectId","#taskId",0,"#tmAddValidationErrorsBox")})),$("#editTimeUserId").on("change",(function(){$("#editTaskId").select2("val",""),$("#editTimeProjectId").select2("val","");var e=$(this).val();g=$(this).val(),getProjectsByUser(e,"#editTimeProjectId","#editTaskId",0,"#teEditValidationErrorsBox")})),$(document).on("click","#task-time-entry-note",(function(){})),$(document).on("click",".taskTimeTracking",(function(){$("#timeTrackingModal").appendTo("body").modal("show")})),canManageEntries||$(document).on("click",".addTaskTimeEntry",(function(){$("#endTime").val(moment().format("YYYY-MM-DD HH:mm:ss")),u=!1,$("#timeUserId").prop("disabled",!0),$("#timeProjectId").prop("disabled",!0),setTimeout((function(){$("#taskId").prop("disabled",!1)}),1e3)})),canManageEntries&&($(document).on("click",".addTaskTimeEntry",(function(e){$("#endTime").val(moment().format("YYYY-MM-DD HH:mm:ss")),u=!1;var t=$(e.currentTarget).attr("data-project-id");$("#timeUserId").empty(),getUserByTask(t,"#timeUserId")})),$(document).on("click",".editTaskTimeEntry",(function(e){var t=$(e.currentTarget).attr("data-project-id");$("#editTimeUserId").empty(),getUserByTask(t,"#editTimeUserId")})),window.getUserByTask=function(e,t){if(!(e>0))return!1;$.ajax({url:route("project-users",e),type:"GET",success:function(e){e.data;$.each(e.data,(function(e,a){var i=document.createElement("textarea");i.innerHTML=a,$(t).append($("<option></option>").attr("value",e).text(i.value))})),$("#timeUserId").val(loggedInUserId).trigger("change.select2"),$("#timeUserId").prop("disabled",!0),$("#timeProjectId").prop("disabled",!0),setTimeout((function(){$("#taskId").prop("disabled",!1)}),1e3)}})}),$(document).on("click",".manuallyTaskTimeEntry",(function(e){$("#endTime").val(moment().format("YYYY-MM-DD HH:mm:ss")),u=!0,$("#timeUserId").empty(),$.ajax({url:route("get-user-lists"),type:"GET",success:function(e){if(null!=e.data.endTime){var t=moment(e.data.endTime).add(5,"seconds").format("YYYY-MM-DD HH:mm:ss");$("#startTime").data("DateTimePicker").date(t)}if(!canManageEntries)return!0;$("#timeUserId").find("option").remove().end().append('<option value="">Select User</option>'),$.each(e.data.users,(function(e,t){$("#timeUserId").append($("<option></option>").attr("value",e).text(t))})),$("#timeUserId").val(loginUserId).trigger("change")}})}))}))})();