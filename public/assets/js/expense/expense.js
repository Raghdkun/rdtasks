(()=>{"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}$(document).ready((function(){$("#expense_table").DataTable({language:{paginate:{previous:'<i class="fas fa-angle-left"></i>',next:'<i class="fas fa-angle-right"></i>'},info:showingText+" _START_ "+toText+" _END_ "+ofText+" _TOTAL_ "+entriesText},processing:!0,serverSide:!0,order:[[0,"asc"]],ajax:{url:route("expenses.index")},columnDefs:[{targets:[5],orderable:!1,className:"text-center",width:"80px"}],columns:[{data:function(e){return format(e.date,"DD-MM-YYYY")},name:"date"},{data:function(e){return console.log(e.project.currency),'<i class="'+function(e){switch(e){case 1:return"fas fa-rupee-sign";case 2:case 3:case 4:return"fas fa-dollar-sign";case 5:return"fas fa-euro-sign";case 6:return"fas fa-pound-sign";default:return"fas fa-dollar-sign"}}(e.project.currency)+'"></i> '+getFormattedPrice(e.amount)},name:"amount"},{data:function(e){if(null!=e.user){var t=document.createElement("textarea");return t.innerHTML=e.user.name,t.value}return"N/A"},name:"user.name"},{data:function(e){var t=document.createElement("textarea");return t.innerHTML=e.client.name,t.value},name:"client.name"},{data:function(e){var t=document.createElement("textarea");return t.innerHTML=e.project.name,t.value},name:"project.name"},{data:function(e){return actionTemplate({Url:route("expenses.index"),viewText,editText,deleteText,id:e.id})},name:"id"}],preDrawCallback:function(){$(".dataTables_filter input").addClass("form-control"),$(".dataTables_filter input").attr("placeholder",searchText)}});if($("#clientId").select2({width:"100%",placeholder:"Select Client"}),$("#projectId").select2({width:"100%",placeholder:"Select Project"}),$("#category").select2({width:"100%"}),$("#expenseDescription").summernote({placeholder:"Add Expense description...",minHeight:200,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]]}),$("#date").datetimepicker({format:"YYYY-MM-DD",useCurrent:!1,locale:"ar"==languageName?"en":languageName,icons:{up:"icon-arrow-up icons",down:"icon-arrow-down icons",previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,maxDate:moment().endOf("day"),widgetPositioning:{horizontal:"left",vertical:"bottom"}}),$(document).on("change","#clientId",(function(){$("#projectId").empty(),$("#projectId").val(null).trigger("change");var e=$(this).val();$.ajax({url:route("expenses.project",e),type:"GET",success:function(e){var t=document.createElement("textarea"),n=e.data;if(""==n)return displayErrorMessage("This client don't have projects."),!1;for(var a in n)t.innerHTML=n[a],n.hasOwnProperty(a)&&($("#projectId").append("<option></option>").trigger("change"),$("#projectId").append($("<option>",{value:a,text:t.value})))}})})),$(document).on("click",".delete-btn",(function(e){var t=$(e.currentTarget).attr("data-id");deleteExpense(route("expenses.destroy",t))})),window.deleteExpense=function(e){swal({title:deleteHeading+" !",text:deleteMessage+' "Expense" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777EF",cancelButtonColor:"#d33",cancelButtonText:noMessages,confirmButtonText:yesMessages},(function(){$.ajax({url:e,type:"DELETE",dataType:"json",success:function(e){e.success&&(1==$("#expense_table").DataTable().data().count()?$("#expense_table").DataTable().page("previous").draw("page"):$("#expense_table").DataTable().ajax.reload(null,!1)),swal({title:"Deleted!",text:"Expense has been deleted.",type:"success",confirmButtonColor:"#6777EF",timer:2e3})},error:function(e){swal({title:"",text:e.responseJSON.message,type:"error",confirmButtonColor:"#6777EF",timer:5e3})}})}))},$(document).on("submit",".expense-form",(function(){$(".files-count").empty();var e=""===$("<div />").html($("#expenseDescription").summernote("code")).text().trim().replace(/ \r\n\t/g,""),t=jQuery(this).find(".save-btn");if(t.button("loading"),0==$("#amount").val())return displayErrorMessage("The amount should be a minimum of 1."),t.button("reset"),!1;if($("#expenseDescription").summernote("isEmpty"))$("#expenseDescription").val("");else if(e)return displayErrorMessage("Description field is not contain only white space"),t.button("reset"),!1})),$("#attachment").length){document.querySelector("#attachment").addEventListener("change",(function(n){var a=this;if($(".files-count").empty(),n.target.files&&window.FileReader){t.innerHTML="";for(var r=n.target.files,o=function(e){var n=r[e],o=new FileReader,i=n.name.split(".").pop().toLowerCase();if(-1==$.inArray(i,["png","jpg","jpeg","xls","xlsx","csv","pdf","doc","docx"]))return displayErrorMessage("The attachment must be a file of type: jpeg, jpg, png, xls, xlsx, pdf, doc"),$(a).val(""),$("#attachmentPicturePreview").addClass("d-none"),{v:!1};$("#attachmentPicturePreview").removeClass("d-none"),o.onload=function(e){if(n.type.match("image*")){var a="<img class='img-thumbnail expense-thumbnail-preview mr-3 mb-2' src=\""+e.target.result+'">';t.innerHTML+=a}else if(n.type.match("pdf*")){t.innerHTML+="<img class='img-thumbnail expense-thumbnail-preview mr-3 mb-2' src=\"/assets/img/pdf_icon.png\">"}else if(n.type.match("sheet*")||n.type.match("ms-excel*")){t.innerHTML+="<img class='img-thumbnail expense-thumbnail-preview mr-3 mb-2' src=\"/assets/img/xls_icon.png\">"}else if(n.type.match("msword*")){t.innerHTML+="<img class='img-thumbnail expense-thumbnail-preview mr-3 mb-2' src=\"/assets/img/doc_icon.png\">"}else t.innerHTML+=n.name},o.readAsDataURL(n)},i=0;i<r.length;i++){var s=o(i);if("object"===e(s))return s.v}var c=r.length,l=1==c?" file selected":" files selected";$(".files-count").append(c+l)}}),!1);var t=document.querySelector("#attachmentPicturePreview")}$(document).on("click",".delete-attachment",(function(){var e=$(this).attr("data-id");swal({title:deleteHeading+" !",text:deleteMessage+' "'+deleteAttachment+'" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777EF",cancelButtonColor:"#d33",cancelButtonText:noMessages,confirmButtonText:yesMessages},(function(){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="_token"]').attr("content")},type:"post",url:route("expense.delete-attachment",e),data:{filename:name,id:e},success:function(){swal({title:"Deleted!",text:"Attachment has been deleted.",type:"success",confirmButtonColor:"#6777EF",timer:2e3}),location.reload()},error:function(e){manageAjaxErrors()}})}))}))}))})();