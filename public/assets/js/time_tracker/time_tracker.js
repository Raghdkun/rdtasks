(()=>{"use strict";var t=1,e=0,a=1,o=10,r=1,i=15;$(document).ready((function(){moment.locale("en"),$("#tmActivityId,#tmProjectId").select2({width:"100%"}),$("#tmTaskId").select2({width:"calc(100% - 44px)"}),$("#trackerTaskProjectId").select2({placeholder:"Select Project",width:"100%"}),"none"==$("#startTimer").css("display")?$(".img-stopwatch").attr("src",timer):$(".img-stopwatch").attr("src",stopWatchImg);loggedInUserId;$.ajax({url:route("notifications.index"),type:"GET",success:function(n){if(!isEmpty(n.data)&&n.success){var s=n.data.first_notification_hour.split(":");t=0==s[0][0]?s[0][1]:s[0],e=0==s[1][0]?s[1][1]:s[1];var d=n.data.second_notification_hour.split(":");a=0==d[0][0]?d[0][1]:d[0],o=0==d[1][0]?d[1][1]:d[1];var c=n.data.third_notification_hour.split(":");r=0==c[0][0]?c[0][1]:c[0],i=0==d[1][0]?c[1][1]:c[1]}},error:function(t){UnprocessableInputError(t)}})}));var n=null;window.loadProjects=function(){$.ajax({url:route("my-projects"),type:"GET",success:function(t){var e=document.createElement("textarea");$("#tmProjectId").find("option").remove().end().append('<option value="">Select Project</option>'),$(t.data).each((function(t,a){e.innerHTML=a.name,$("#tmProjectId").append($("<option></option>").attr("value",a.id).text(e.value))})),null!==getItemFromLocalStorage("clockRunning")&&(n=getItemFromLocalStorage("project_id"),$("#tmProjectId").val(n).trigger("change"),$("#tmProjectId").attr("disabled",!0))}})},loadProjects();var s=getItemFromLocalStorage("clockRunning");$(window).on("load",(function(){null==s&&($.ajax({url:route("user-last-task-work"),type:"GET",success:function(t){if(t.success&&t.data){var e=t.data;null==s&&(k({user_id:loggedInUserId,activity_id:e.activity_id,task_id:e.task_id,project_id:e.project_id}),n=e.project_id,$("#tmProjectId").val(e.project_id).trigger("change"))}}}),$("#addTaskTracker").show())})),window.revokerTracker=function(){loadProjects(),isEmpty()||setTimeout((function(){$("#tmProjectId").val(n).trigger("change")}),1500)},window.showStartTimeButton=function(){$("#stopTimer").hide(),$("#timer").html("<h3><b>00:00:00</b></h3>"),$("#startTimer").show()},window.startWatch=function(){if(null!=getItemFromLocalStorage("clockRunning")){$("#startTimer").hide(),$("#stopTimer").show();var n=null!==getItemFromLocalStorage("start_time")?getItemFromLocalStorage("start_time"):T(),s=new Date($.now()),u=new Date(moment(n).format("YYYY-MM-DD HH:mm:ss")),v=parseInt(s-u);I=parseInt(v/36e5%24),p=parseInt(v/6e4%60),g=parseInt(v/1e3%60),l=I<10?"0"+I+": ":I+": ",m=p<10?"0"+p+": ":p+": ",c=g<10?"0"+g:g,localStorage.getItem("hours_"+loggedInUserId)==t&&localStorage.getItem("minutes_"+loggedInUserId)==e&&localStorage.getItem("seconds_"+loggedInUserId)==parseInt("1")?"0"==t&&"0"==e||Push.create("Hello "+loggedInUserName,{body:"Your tracker time limit is exceed. Please stop your tracker.",icon:notificationImg,timeout:5e3,url:notificationUrl,onClick:function(){window.focus()}}):(localStorage.getItem("hours_"+loggedInUserId)==a&&localStorage.getItem("minutes_"+loggedInUserId)==o&&localStorage.getItem("seconds_"+loggedInUserId)==parseInt("1")||localStorage.getItem("hours_"+loggedInUserId)==r&&localStorage.getItem("minutes_"+loggedInUserId)==i&&localStorage.getItem("seconds_"+loggedInUserId)==parseInt("1"))&&Push.create("Hello "+loggedInUserName,{body:"Your tracker time limit is exceed. Please stop your tracker.",icon:notificationImg,timeout:5e3,url:notificationUrl,onClick:function(){window.focus()}}),$("#timer").html("<h3><b>"+l+m+c+"</b></h3>"),k({seconds:++g,minutes:p,hours:I}),d=setTimeout("startWatch( )",1e3)}else showStartTimeButton()},window.stopWatch=function(){setTimeout("stopWatch( )",1e3)};var d;$(document).on("click","#imgTimer",(function(){$("#timeTracker").is(":hidden")?($("#timeTracker").show(),$(".img-stopwatch").attr("src",closeWatchImg)):($("#timeTracker").hide(),"none"==$("#startTimer").css("display")?$(".img-stopwatch").attr("src",timer):$(".img-stopwatch").attr("src",stopWatchImg)),$("#validationErrorsBox").hide()})),null!==getItemFromLocalStorage("clockRunning")&&startWatch(),$("#drpUsers,#drpActivity,#drpTasks").select2({width:"100%"});var c,m,l,u,g=0,p=0,I=0;function v(t,e){t=new Date(t),e=new Date(e);var a=(t.getTime()-e.getTime())/1e3;return a/=60,Math.abs(Math.round(a))}function h(t,e){$.ajax({url:route("time-entries.store"),type:"POST",data:$("#timeTrackerForm").serialize()+"&start_time="+t+"&end_time="+e,success:function(t){if(t.success){if(stopLoader(),$("#loader").hide(),swal({title:"Success",text:"Time Entry stored successfully!",type:"success",confirmButtonColor:"#6777EF",timer:1e3}),"/tasks"==url&&window.livewire.emit("refresh"),stopWatch(),$("#stopTimer").hide(),$("#timer").html("<h3><b>00:00:00</b></h3>"),$("#startTimer").show(),clearTimeout(d),r=["user_id","activity_id","task_id","clockRunning","start_time","seconds","minutes","hours","notes"],$.each(r,(function(t,e){localStorage.removeItem(e+"_"+loggedInUserId)})),$("#taskTimeEntryTable").DataTable().ajax.reload(null,!1),"/dashboard"==window.location.pathname){var e=moment(),a=e.clone().startOf("month"),o=e.clone().endOf("month");loadUserWorkReport(a.format("YYYY-MM-D  H:mm:ss"),o.format("YYYY-MM-D  H:mm:ss"),loggedInUserId),loadDevelopersWorkReport(e.format("YYYY-MM-D  H:mm:ss"))}$("#timeTracker").hide(),$(".img-stopwatch").attr("src",stopWatchImg),$("#tmNotes").val(""),localStorage.removeItem("notes_"+loggedInUserId)}var r},error:function(t){stopLoader(),printErrorMessage("#timeTrackerValidationErrorsBox",t),$("#tmActivityId").attr("disabled",!0),$("#tmTaskId").attr("disabled",!0),$("#tmProjectId").attr("disabled",!0),$("#stopTimer").removeAttr("disabled"),$("#timeTrackerForm").find("#tmTaskId").val()>0||$("#tmTaskId").prop("disabled",!1)},complete:function(){}})}function T(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=null===t?new Date($.now()):new Date(t),a=e.getDate()<10?"0"+e.getDate():e.getDate(),o=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,r=e.getHours()<10?"0"+e.getHours():e.getHours(),i=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),n=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return e.getFullYear()+"-"+o+"-"+a+" "+r+":"+i+":"+n}function k(t){$.each(t,(function(t,e){localStorage.setItem(t+"_"+loggedInUserId,e)}))}$(document).on("click","#startTimer",(function(t){var e=$("#tmActivityId").val(),a=$("#tmTaskId").val(),o=$("#tmProjectId").val();""!=o&&""!=e&&""!=a&&null!=a&&(t.preventDefault(),localStorage.setItem("currentTaskId",a),localStorage.setItem("currentActivityId",e),$("#stopTimer").removeAttr("disabled"),function(t,e,a){$("#tmActivityId").attr("disabled",!0),$("#tmTaskId").attr("disabled",!0),$("#tmProjectId").attr("disabled",!0),k({user_id:loggedInUserId,activity_id:t,task_id:e,project_id:a,clockRunning:true}),u=T(),null!==getItemFromLocalStorage("start_time")?u=getItemFromLocalStorage("start_time"):k({start_time:u});startWatch()}(e,a,o),$.ajax({url:route("start-timer"),type:"post",data:{activity:$("#tmActivityId").val(),task:$("#tmTaskId").val(),project:$("#tmProjectId").val()},success:function(){},error:function(t){printErrorMessage("#timeTrackerValidationErrorsBox",t)}}))})),$(document).on("click","#stopTimer",(function(t){t.preventDefault(),localStorage.removeItem("currentTaskId"),localStorage.removeItem("currentActivityId"),$(this).attr("disabled","true"),$("#tmActivityId").removeAttr("disabled"),$("#tmTaskId").removeAttr("disabled"),$("#tmProjectId").removeAttr("disabled"),$("#tmNotes").html(""),$("#tmNotesErr").html(""),g=p=I=0,$("#loader").show(),function(){var t=getItemFromLocalStorage("start_time"),e=T();v(e,t)>720?(a=getItemFromLocalStorage("start_time"),$("#tmAdjustValidationErrorsBox").show(),$("#tmAdjustValidationErrorsBox").html("Time Entry must be less than 12 hours."),$("#adjustStartTime").val(a),$("#adjustStartTime").attr("disabled","true"),$("#timeEntryAdjustModal").modal(),$("#stopTimer").removeAttr("disabled")):h(t,e);var a}()})),$("#timeEntryAdjustModal").on("hidden.bs.modal",(function(){$("#adjustEndTime").prop("disabled",!1),$("#adjustStartTime").prop("disabled",!1),$("#adjustEndTime").data("DateTimePicker").date(null),$("#adjustStartTime").data("DateTimePicker").date(null),resetModalForm("#timeEntryAdjustForm"),$("#tmAdjustValidationErrorsBox").hide()})),$("#adjustStartTime").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!0,locale:"ar"==languageName?"en":languageName,icons:{up:"icon-arrow-up icons",down:"icon-arrow-down icons",previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,maxDate:moment().endOf("day")}),$("#adjustEndTime").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!0,locale:"ar"==languageName?"en":languageName,icons:{up:"icon-arrow-up icons",down:"icon-arrow-down icons",previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,maxDate:moment().endOf("day")}),$("#adjustStartTime,#adjustEndTime").on("dp.change",(function(){var t=$("#adjustStartTime").val(),e=$("#adjustEndTime").val(),a=0;e&&(a=new Date(Date.parse(e)-Date.parse(t))/6e4,Number.isInteger(a)||(a=a.toFixed(2)));$("#adjustDuration").val(a).prop("disabled",!0),$("#adjustStartTime").data("DateTimePicker").maxDate(moment().endOf("now")),$("#adjustEndTime").data("DateTimePicker").maxDate(moment().endOf("now")),a<720&&$("#tmAdjustValidationErrorsBox").hide()})),$(document).on("click","#adjustBtnSave",(function(){var t=$("#adjustStartTime").val(),e=$("#adjustEndTime").val();v(e,t)>720?($("#tmAdjustValidationErrorsBox").show(),$("#tmAdjustValidationErrorsBox").html("Time Entry must be less than 12 hours.")):($("#adjustBtnCancel").trigger("click"),h(t,e))})),$("#tmProjectId").on("change",(function(t){t.preventDefault(),$("#tmTaskId").attr("disabled",!0),function(t){$.ajax({url:myTasksUrl+"?project_id="+t,type:"GET",success:function(t){var e=document.createElement("textarea");$("#tmTaskId").find("option").remove().end().append('<option value="">Select Task</option>'),$("#tmTaskId").val("").trigger("change");var a=getItemFromLocalStorage("task_id"),o=getItemFromLocalStorage("activity_id"),r=getItemFromLocalStorage("notes"),i=!0;$.each(t.data.tasks,(function(t,o){e.innerHTML=o,$("#tmTaskId").append($("<option></option>").attr("value",t).text(e.value)),t==a&&(i=!1)})),$("#tmActivityId").find("option").remove().end().append('<option value="">Select Activity</option>'),$("#tmActivityId").val("").trigger("change"),$(t.data.activities).each((function(t,e){$("#tmActivityId").append($("<option></option>").attr("value",e.id).text(e.name))})),$("#tmTaskId").removeAttr("disabled"),null!==getItemFromLocalStorage("clockRunning")?($("#tmActivityId").val(o).trigger("change"),$("#tmTaskId").val(a).trigger("change"),$("#tmNotes").val(r),$("#tmTaskId").attr("disabled",!0),$("#tmActivityId").attr("disabled",!0)):($("#tmActivityId").val(o).trigger("change"),$("#tmTaskId").val(a).trigger("change")),i&&$("#tmTaskId").val($("#tmTaskId option:first").val()).trigger("change")}})}(n=$("#tmProjectId").val())})),$("#tmNotes").on("keyup",(function(){k({notes:$(this).val()})})),$(document).on("click","#addTaskTracker",(function(){$.ajax({url:route("projects.login.user"),type:"GET",success:function(t){var e=document.createElement("textarea");$("#trackerTaskProjectId").empty(),$.each(t.data,(function(t,a){e.innerHTML=t,$("#trackerTaskProjectId").append($("<option></option>").attr("value",a).text(e.value))})),$("#addTrackerTaskModal").modal("show")}})})),$(document).on("submit","#addTrackerTaskForm",(function(t){t.preventDefault();var e=jQuery(this).find("#btnTrackerTaskSave");e.button("loading");var a=$(this).serialize();$.ajax({url:"/tracker/task",type:"POST",data:a,success:function(t){t.success&&(displaySuccessMessage(t.message),$("#addTrackerTaskModal").modal("hide"),revokerTracker(),"/tasks"===window.location.pathname&&window.livewire.emit("refresh"),"/dashboard"===window.location.pathname&&loadUsersOpenTasks(),e.button("reset"))},error:function(t){displayErrorMessage(t.responseJSON.message)},complete:function(){e.button("reset")}})})),$("#addTrackerTaskModal").on("hidden.bs.modal",(function(){$("#addTrackerTaskForm")[0].reset()}))})();