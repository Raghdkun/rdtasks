(()=>{"use strict";$(document).ready((function(){$("#AddModal,#EditModal").on("show.bs.modal",(function(){$(this).appendTo("body")})),$("#AddModal").on("hidden.bs.modal",(function(){$("#description").summernote("code",""),$("#startDate").data("DateTimePicker").date(moment().format("YYYY-MM-DD")+" 00:00"),$("#startDate").data("DateTimePicker").date(null),$("#endDate").data("DateTimePicker").date(moment().format("YYYY-MM-DD")+" 00:00"),$("#endDate").data("DateTimePicker").date(null),resetModalForm("#addNewForm","#validationErrorsBox"),$("#type").val(1).trigger("change.select2")})),$("#EditModal").on("hidden.bs.modal",(function(){$("#editDescription").summernote("code",""),resetModalForm("#editForm","#editValidationErrorsBox")})),$("#description,#editDescription").summernote({placeholder:"Add Event description...",minHeight:200,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]]}),$("#type,#editType").select2({width:"100%"}),$("#startDate, #endDate").datetimepicker({format:"YYYY-MM-DD HH:mm",useCurrent:!1,locale:"ar"==languageName?"en":languageName,widgetPositioning:{horizontal:"left",vertical:"bottom"},icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons",up:"icon-arrow-up icons",down:"icon-arrow-down icons",clear:"icon-trash icons"},sideBySide:!0,showClear:!0}),$("#startDate").on("dp.change",(function(e){$("#endDate").data("DateTimePicker").minDate(e.date)})),$("#editStartDate, #editEndDate").datetimepicker({format:"YYYY-MM-DD HH:mm",useCurrent:!1,locale:"ar"==languageName?"en":languageName,widgetPositioning:{horizontal:"left",vertical:"bottom"},icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons",up:"icon-arrow-up icons",down:"icon-arrow-down icons",clear:"icon-trash icons"},sideBySide:!0,showClear:!0}),$("#editStartDate").on("dp.change",(function(e){$("#editEndDate").data("DateTimePicker").minDate(e.date)})),$("#eventsCalendarFilter").datetimepicker({format:"MMMM/YYYY",viewMode:"months",sideBySide:!0,icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons",up:"icon-arrow-up icons",down:"icon-arrow-down icons",clear:"icon-trash icons"}});$("#calenders").fullCalendar({height:850,header:{left:"prev,next today",center:"title",right:"month,agendaWeek"},nextDayThreshold:"00:00:00",forceEventDuration:!0,defaultDate:new Date,defaultView:"month",editable:permission,droppable:!0,allDaySlot:!1,eventLimit:3,eventLimitText:"More",locale:languageName,eventDrop:function(e){permission&&eventsUpdateForCalendar(e)},eventClick:function(e,t){if(permission){var n=t.target.classList.value;"fa fa-trash"==n||"action-div justify-content-around"==n?deleteEvent(e):editEvent(e)}},eventRender:function(e,t){t.find(".fc-time").empty(),permission&&t.find(".fc-content").append('<div class="action-div justify-content-around"><div style="padding-top: 5px;"><a href="#" class="delete-btn" data-id="'+e.id+'" title="'+eventDeleteText+'"><i class="fa fa-trash"></i></a></div></div>'),2!=e.type&&t.find(".fc-title").append("<br>"+e.start_time+" to "+e.end_time)},eventAfterRender:function(e,t){permission||t.find(".fc-content").css("cursor","default"),isEmpty(e.description)||$(t).tooltip({title:e.description,html:!0,container:"body"})}});var e=$("#eventsCalendarFilter").val();$(document).ready((function(){getEventsDataForCalendar(e)})),$(".fc-today-button").click((function(){$("#eventsCalendarFilter").val(moment().format("MMMM/Y")),e=$("#eventsCalendarFilter").val()})),$(".fc-agendaWeek-button").click((function(){e==moment().format("MMMM/Y")&&$("#calenders").fullCalendar("changeView","agendaWeek",moment().format("YYYY-MM-DD"))})),$(document).on("dp.change","#eventsCalendarFilter",(function(){e=$(this).val(),startLoader(),getEventsDataForCalendar(e)})),window.getEventsDataForCalendar=function(e){$.ajax({url:route("events.data"),type:"GET",success:function(t){screenUnLock(),t.success&&($("#calenders").fullCalendar("removeEvents"),$("#calenders").fullCalendar("changeView","month",moment(e).format("YYYY-MM-DD")),$("#calenders").fullCalendar("addEventSource",t.data),$("#calendars").fullCalendar("rerenderEvents"))},error:function(e){manageAjaxErrors(e)}})},window.eventsUpdateForCalendar=function(e){var t=e.id,n=moment(e.start).format("YYYY-MM-DD HH:mm:ss"),a=moment(e.end).format("YYYY-MM-DD HH:mm:ss");$.ajax({url:route("events.drop.update",t),type:"POST",data:{start_date:n,end_date:a},success:function(e){e.success&&getEventsDataForCalendar()},error:function(e){manageAjaxErrors(e)}})},window.editEvent=function(e){startLoader(),$.ajax({url:route("events.edit",e.id),type:"GET",success:function(e){var t=e.data;e.success&&($("#editTitle").val(t.title),$("#editStartDate").val(moment(t.start_date).format("YYYY-MM-DD HH:mm")),$("#editEndDate").val(moment(t.end_date).format("YYYY-MM-DD HH:mm")),$("#editEndDate").data("DateTimePicker").minDate(t.start_date),$("#editType").val(t.type).trigger("change"),$("#editDescription").summernote("code",t.description),$("#Id").val(t.id),$("#EditModal").modal("show"),stopLoader())},error:function(e){manageAjaxErrors(e)}})},$(document).on("submit","#addNewForm",(function(t){t.preventDefault();var n=""===$("<div />").html($("#description").summernote("code")).text().trim().replace(/ \r\n\t/g,""),a=jQuery(this).find("#btnSave");if(a.button("loading"),$("#description").summernote("isEmpty"))$("#description").val("");else if(n)return displayErrorMessage("Description field is not contain only white space"),a.button("reset"),!1;$(this);var o=$(this).serializeArray();$.ajax({url:route("events.index"),type:"POST",data:o,success:function(t){t.success&&(displaySuccessMessage(t.message),$("#AddModal").modal("hide"),getEventsDataForCalendar(e))},error:function(e){printErrorMessage("#validationErrorsBox",e)},complete:function(){a.button("reset")}})})),$(document).on("submit","#editForm",(function(t){t.preventDefault();var n=$("#Id").val(),a=""===$("<div />").html($("#editDescription").summernote("code")).text().trim().replace(/ \r\n\t/g,""),o=jQuery(this).find("#btnSave");if(o.button("loading"),$("#editDescription").summernote("isEmpty"))$("#editDescription").val("");else if(a)return displayErrorMessage("Description field is not contain only white space"),o.button("reset"),!1;$(this);var i=$(this).serializeArray();$.ajax({url:route("events.update",n),type:"POST",data:i,success:function(t){t.success&&(displaySuccessMessage(t.message),$("#EditModal").modal("hide"),getEventsDataForCalendar(e))},error:function(e){printErrorMessage("#editValidationErrorsBox",e)},complete:function(){o.button("reset")}})})),window.deleteEvent=function(t){swal({title:deleteHeading+" !",text:deleteMessage+' "Event" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777EF",cancelButtonColor:"#d33",cancelButtonText:noMessages,confirmButtonText:yesMessages},(function(){$("#calenders").fullCalendar("editable",!1),$.ajax({url:route("events.delete",t.id),type:"DELETE",dataType:"json",success:function(t){t.success&&getEventsDataForCalendar(e),swal({title:"Deleted!",text:"Event has been deleted.",type:"success",confirmButtonColor:"#6777EF",timer:2e3})},error:function(e){swal({title:"",text:e.responseJSON.message,type:"error",confirmButtonColor:"#6777EF",timer:5e3})}})}))}})),window.onscroll=function(){$(".tooltip").hide()}})();