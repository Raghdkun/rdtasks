(()=>{"use strict";var e="";0!=$(".color-wrapper").length&&(e=Pickr.create({el:".color-wrapper",theme:"nano",closeWithKey:"Enter",autoReposition:!0,defaultRepresentation:"HEX",swatches:["rgba(244, 67, 54, 1)","rgba(233, 30, 99, 1)","rgba(156, 39, 176, 1)","rgba(103, 58, 183, 1)","rgba(63, 81, 181, 1)","rgba(33, 150, 243, 1)","rgba(3, 169, 244, 1)","rgba(0, 188, 212, 1)","rgba(0, 150, 136, 1)","rgba(76, 175, 80, 1)","rgba(139, 195, 74, 1)","rgba(205, 220, 57, 1)","rgba(255, 235, 59, 1)","rgba(255, 193, 7, 1)"],components:{preview:!0,hue:!0,interaction:{input:!0,clear:!1}}})).on("change",(function(){var t=e.getColor().toHEXA().toString();if(wc_hex_is_light(t))return $(".editValidationErrorsBox").text(""),$(".editValidationErrorsBox").show().html(""),$(".editValidationErrorsBox").text("Pick a different color"),setTimeout((function(){$(".editValidationErrorsBox").slideUp()}),5e3),void $(':input[id="btnEditSave"]').prop("disabled",!0);$(':input[id="btnEditSave"]').prop("disabled",!1),e.setColor(t),$("#edit_color").val(t)})),$(document).ready((function(){$("#client_id, #edit_client_id").select2({width:canManageClients?"calc(100% - 44px)":"100%",placeholder:"Select Client"}),$("#department_id").select2({width:"100%",placeholder:"Select Department"}),$("#editCurrency,#edit_budget_type,#budget_type,#editStatusProject").select2({width:"100%"}),$("#edit_user_ids").select2({width:"100%",placeholder:"Select Users"})})),$("#editDescription").summernote({placeholder:"Add Project description...",minHeight:200,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]]}),$("#ProjectEditModal").on("show.bs.modal",(function(){$(".pcr-button").css("border","1px solid grey"),$(".project_remaining_user").popover("hide")})),$(document).on("submit","#editFormProject",(function(e){e.preventDefault();$(this);var t=""===$("<div />").html($("#editDescription").summernote("code")).text().trim().replace(/ \r\n\t/g,"");if(0==$("#editPrice").val())return displayErrorMessage("The budget amount should be a minimum of 1."),!1;if(removeCommas($("#editPrice").val()).length>12)return displayErrorMessage("Maximum 12 digits budget amount is allowed."),!1;var a=jQuery(this).find("#btnEditSave");if(a.button("loading"),$("#editDescription").summernote("isEmpty"))$("#editDescription").val("");else if(t)return displayErrorMessage("Description field is not contain only white space"),a.button("reset"),!1;var i=$(this).serializeArray();i[i.length]={name:"color",value:$("#edit_color").val()};var r=$("#projectId").val();$.ajax({url:route("projects.update",r),type:"put",data:i,success:function(e){e.success&&(displaySuccessMessage(e.message),$("#ProjectEditModal").modal("hide"),$("#projects_table").DataTable().ajax.reload(null,!1),revokerTracker(),location.reload(!0))},error:function(e){displayErrorMessage(e.responseJSON.message)},complete:function(){a.button("reset")}})})),$("#ProjectEditModal").on("hidden.bs.modal",(function(){$("#editDescription").summernote("code",""),resetModalForm("#editFormProject","#editValidationErrorsBox")})),window.renderData=function(t){$.ajax({url:route("projects.edit",t),type:"GET",success:function(t){if(t.success){var a=t.data.project,i=document.createElement("textarea");i.innerHTML=a.name,$("#projectId").val(a.id),$("#edit_name").val(i.value),$("#edit_prefix").val(a.prefix),e.setColor(a.color),$("#edit_client_id").val(a.client_id).trigger("change"),$("#editStatusProject").val(a.status).trigger("change"),$("#editDescription").summernote("code",a.description),isEmpty(a.price)||$("#editPrice").val(getFormattedPrice(a.price)),$("#editCurrency").val(a.currency).trigger("change"),$("#edit_budget_type").val(a.budget_type).trigger("change");var r=t.data.users;$("#edit_user_ids").val(r),$("#edit_user_ids").trigger("change"),$("#ProjectEditModal").modal("show")}},error:function(e){manageAjaxErrors(e)}})},$(document).on("click",".edit-btn",(function(e){var t=$(e.currentTarget).attr("data-id");renderData(t)})),$(".modal").on("show.bs.modal",(function(){$(this).appendTo("body")})),$("[data-toggle=popover]").popover({html:!0,content:function(){return $("#popover-content").html()}}),$((function(){$("#editAssignTo").select2({width:"100%",placeholder:"Select Assignee"}),$("#editProjectId").select2({width:"100%",placeholder:"Select Project"}),$("#editStatus").select2({width:"calc(100% - 44px)"}),$("#editAssignee").select2({width:"100%",placeholder:"Select Assignee"}),canManageTags?$("#editTagIds").select2({width:"100%",tags:!0,placeholder:"Select Tags",createTag:function(e){var t=!1;if($("#editTagIds option").each((function(){$.trim(e.term).toUpperCase()===$.trim($(this).text()).toUpperCase()&&(t=!0)})),!t)return{id:e.term,text:e.term}}}):$("#editTagIds").select2({width:"100%",placeholder:"Select Tags"}),$("#editPriority").select2({width:"100%"}),$("#dueDate,#editDueDate").datetimepicker({format:"YYYY-MM-DD",useCurrent:!1,locale:"ar"==languageName?"en":languageName,icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,minDate:moment().millisecond(0).second(0).minute(0).hour(0)}),$("#dueDate, #editDueDate").on("dp.show",(function(){matchWindowScreenPixels({dueDate:"#dueDate",editDueDate:"#editDueDate"},"tsk")})),$(window).resize((function(){matchWindowScreenPixels({dueDate:"#dueDate",editDueDate:"#editDueDate"},"tsk")})).trigger("resize"),$('[data-toggle="tooltip"]').tooltip()}));var t,a,i=$("#taskEditDescription").summernote({placeholder:"Add Task description...",minHeight:200,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]]}),r=[];function n(e){e.preventDefault();var t=e.target.files,a=$("#tagId").val();t.length;for(var i=0;i<t.length;i++){var r=t[i].name.split(".").pop().toLowerCase();if(-1==$.inArray(r,["png","jpg","jpeg","xls","xlsx","csv","pdf","doc","docx"]))return displayErrorMessage("The attachment must be a file of type: jpeg, jpg, png, xls, xlsx, pdf, doc"),$(this).val(""),!1;var n=new FormData;if(n.append("file",t[i]),t[i].size>1e6)return displayErrorMessage("The attachment size should not greater than 12 mb."),$(this).val(""),!1;$.ajax({url:route("task.add-attachment",a),type:"post",data:n,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(e){var t=e.data;if(e.success){$("#noAttachmentFound").empty();var a,i=t.file_name.split(".").pop(),r=[];r=t.file_url,"xlsx"!==i&&"xls"!==i&&"csv"!==i||(r="/assets/img/xls_icon.png"),"pdf"===i&&(r="/assets/img/pdf_icon.png"),"docx"!==i&&"doc"!==i||(r="/assets/img/doc_icon.png"),a=[{id:t.id,url:t.file_url,image:r,username:t.user,downloadTask:route("tasks.index"),updated_at:moment(t.updated_at).fromNow(),createdId:t.userId,loginUserId:loggedInUserId}],$("#previewImageEdit").append(prepareTemplateRender("#attachmentImage",a))}scrollToTheBottomAttachment()},error:function(e){manageAjaxErrors(e)},complete:function(){}})}}$(document).on("click",".edit-task-btn",(function(e){var t=$(e.currentTarget).attr("data-id");$.ajax({url:route("tasks.edit",t),type:"GET",success:function(e){if(e.success){var t=e.data.task,a=e.data.tags,i=document.createElement("textarea");$("#editTagIds").empty(),$.each(a,(function(e,t){i.innerHTML=t,$("#editTagIds").append($("<option>",{value:e,text:i.value}))}));t.description;var n=document.createElement("textarea");n.innerHTML=t.title,$("#tagId").val(t.id),$("#ThisTaskId").val(t.id),$("#editTitle").val(n.value),$("#taskEditDescription").summernote("code",t.description),$("#editDueDate").val(t.due_date),$("#editProjectId").val(t.project.id).trigger("change"),$("#editStatus").val(t.status).trigger("change"),null==t.estimate_time_type&&null==t.estimate_time&&$("#editDays").removeClass("btn-primary text-white"),0==t.estimate_time_type||null==t.estimate_time?($("#editEstimateTimeDays").hide(),$("#editEstimateTimeHours").val(t.estimate_time).show(),$("#editHours").addClass("btn-primary text-white"),$("#editDays").removeClass("btn-primary text-white"),$("#editTypes").val(0)):($("#editEstimateTimeHours").hide(),$("#editEstimateTimeDays").val(t.estimate_time).show(),$("#editDays").addClass("btn-primary text-white"),$("#editHours").removeClass("btn-primary text-white"),$("#editTypes").val(1));var o=[],s=[];$(t.tags).each((function(e,t){o.push(t.id)})),$("#previewImageEdit").empty(),$(t.media).each((function(e,a){var i=t.attachments[e].file_name.split(".").pop().toLowerCase(),r=[];r=t.attachments[e].original_url,"xlsx"!==i&&"xls"!==i&&"csv"!==i||(r="/assets/img/xls_icon.png"),"pdf"===i&&(r="/assets/img/pdf_icon.png"),"docx"!==i&&"doc"!==i||(r="/assets/img/doc_icon.png");var n;n=[{id:t.attachments[e].id,url:t.attachments[e].original_url,image:r,username:t.created_user.name,downloadTask:route("tasks.index"),updated_at:moment(t.attachments[e].updated_at).fromNow(),createdId:t.created_user.id,loginUserId:loggedInUserId}],$("#previewImageEdit").append(prepareTemplateRender("#attachmentImage",n))})),0==t.media.length&&$("#noAttachmentFound").text("No attachments added yet"),$(t.task_assignee).each((function(e,t){s.push(t.id),r.push(t.id)})),$("#editTagIds").val(o).trigger("change"),$("#editAssignee").val(s).trigger("change"),$("#editPriority").val(t.priority).trigger("change"),setTimeout((function(){$.each(t.task_assignee,(function(e,t){$("#editAssignee option[value='"+t.id+"']").prop("selected",!0).trigger("change")})),$("#EditModal").appendTo("body").modal("show")}),1500)}},error:function(e){displayErrorMessage(e.responseJSON.message)}})})),$(document).on("change","#editProjectId",(function(e){!function(e,t){$("#"+t).empty(),$("#"+t).trigger("change"),$.ajax({url:route("users-of-projects")+"?projectIds="+e,type:"GET",success:function(e){var a=e.data;for(var i in a)a.hasOwnProperty(i)&&$("#"+t).append($("<option>",{value:i,text:a[i]}))}})}($(this).val(),"editAssignee")})),$(document).on("submit","#editForm",(function(e){e.preventDefault();var t=""===$("<div />").html($("#taskEditDescription").summernote("code")).text().trim().replace(/ \r\n\t/g,""),a=jQuery(this).find("#btnTaskEditSave");if(a.button("loading"),$("#taskEditDescription").summernote("isEmpty"))$("#taskEditDescription").val("");else if(t)return displayErrorMessage("Description field is not contain only white space"),a.button("reset"),!1;if(""==$("#editTitle").val().trim())return displayErrorMessage("Title field is not contain only white space"),a.button("reset"),!1;var r=$("#tagId").val(),n=getItemFromLocalStorage("task_id"),o=getItemFromLocalStorage("clockRunning");if(r===n&&"true"===o)return swal({title:"Warning",text:"Please stop timer before updating task.",type:"warning",confirmButtonColor:"#6777EF"}),a.button("reset"),!1;var s=$(this).serializeArray();i.summernote("code");$.ajax({url:route("tasks.update",r),type:"put",data:s,success:function(e){e.success&&($("#EditModal").modal("hide"),window.livewire.emit("refresh"),a.button("reset"),displaySuccessMessage("Task updated successfully."))},error:function(e){a.button("reset"),printErrorMessage("#editValidationErrorsBox",e)}})})),$("#EditModal").on("hidden.bs.modal",(function(){i.summernote("code",""),$("#editDueDate").data("DateTimePicker").clear(),$("#editEstimateTimeHours").data("DateTimePicker").date("00:00"),$("#editDays").removeClass("btn btn-primary text-white"),$("#editHours").addClass("btn btn-primary text-white"),$("#editTypes").val(0),$("#editEstimateTimeDays").hide().val(""),$("#editEstimateTimeHours").show().val(""),$("#previewImageEdit").empty(),$("#noAttachmentFound").empty(),$(this).removeClass("disabled"),resetModalForm("#editForm","#editValidationErrorsBox")})),$(document).ready((function(){$('a[data-toggle="tab"]').on("shown.bs.tab",(function(e){localStorage.setItem("activeTab",$(e.target).attr("href"))}));var e=localStorage.getItem("activeTab");e&&($('.nav-tabs a[href="'+e+'"]').tab("show"),localStorage.removeItem("activeTab"))})),$((function(){$(document).on("change","input.complete-task-checkbox",(function(e){var i=$(this).attr("data-check");a=$(this);var r=getItemFromLocalStorage("task_id"),n=getItemFromLocalStorage("clockRunning");if(i===r&&"true"===n)return swal({title:"Warning",text:"Please stop timer before completing task.",type:"warning",confirmButtonColor:"#6777EF"}),a.prop("checked",!1),!1;""!=$("#filter_status").val()&&$(this).parentsUntil(".task-list").toggle("slide"),t(i)})),t=function(e){$.ajax({url:route("tasks.update-status",e),type:"PUT",cache:!1,data:{status:1},success:function(e){window.livewire.emit("refresh"),revokerTracker()}})}})),$(document).ready((function(){$("#editEstimateTimeHours").datetimepicker({format:"HH:mm",useCurrent:!1,locale:"ar"==languageName?"en":languageName,icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons",up:"icon-arrow-up icons",down:"icon-arrow-down icons"},sideBySide:!0}),$("#editEstimateTimeDays").hide(),$(document).on("click","#editHours",(function(){$("#editDays").removeClass("btn btn-primary text-white"),$(this).addClass("btn btn-primary text-white"),$("#editTypes").val(0),$("#editEstimateTimeDays").hide().val(""),$("#editEstimateTimeHours").show()})),$(document).on("click","#editDays",(function(){$("#editHours").removeClass("btn btn-primary text-white"),$(this).addClass("btn btn-primary text-white"),$("#editTypes").val(1),$("#editEstimateTimeHours").data("DateTimePicker").date("00:00"),$("#editEstimateTimeHours").hide().val(""),$("#editEstimateTimeDays").show()})),$(document).on("submit","#addNewStatusForm",(function(e){e.preventDefault();var t=jQuery(this).find("#btnSave");t.button("loading"),$.ajax({url:"/status",type:"POST",data:$(this).serialize(),success:function(e){if($("#editStatus").empty(),e.success){displaySuccessMessage(e.message);var t="<option value=''>Select Status</option>";$.each(e.data.statuses,(function(e,a){t+="<option value='"+a+"'>"+e+"</option>",$("#editStatus").html(t)})),$("#editStatus").val(e.data.status.status).trigger("change"),$("#addStatusModal").modal("hide")}},error:function(e){printErrorMessage("#validationErrorsBox",e)},complete:function(){t.button("reset")}})})),$(document).on("click",".add_modal",(function(e){e.preventDefault(),$("#addStatusModal").appendTo("body").modal("show")})),$("#addStatusModal").on("hidden.bs.modal",(function(){resetModalForm("#addNewStatusForm","#validationErrorsBox")})),$(document).on("submit","#addNewClientForm",(function(e){e.preventDefault();var t=jQuery(this).find("#btnClientSave");t.button("loading"),$.ajax({url:"/client/store",type:"POST",data:$(this).serializeArray(),success:function(e){if($("#client_id").empty(),e.success){displaySuccessMessage(e.message);var t="<option value=''>Select Client</option>";$.each(e.data.clients,(function(e,a){t+="<option value='"+e+"'>"+a+"</option>",$("#edit_client_id").html(t)})),$("#ProjectEditModal").hasClass("show")&&$("#edit_client_id").val(e.data.client.id).trigger("change.select2"),$("#addClientModal").modal("hide")}},error:function(e){printErrorMessage("#clientValidationErrorsBox",e)},complete:function(){t.button("reset")}})})),$("#addClientModal").on("hidden.bs.modal",(function(){resetModalForm("#addNewClientForm","#clientValidationErrorsBox"),$("#department_id").val("").trigger("change.select2")})),$(document).on("click","#addTask",(function(e){e.preventDefault();var t=$(this).attr("data-id");$("#taskProjectId").val(t),$("#notFoundYet").text("No attachments added yet"),$("#addTaskModal").appendTo("body").modal("show")}))})),document.addEventListener("DOMContentLoaded",(function(){document.querySelector("#editTaskAddAttachment").addEventListener("change",n,!1)}),!1),$(".btn-upload").hide(),window.scrollToTheBottomAttachment=function(){setTimeout((function(){var e=$("#card-attachments-container-edit").outerHeight();$(".attachments-content-edit").scrollTop(e*e)}),200)},Dropzone.options.dropzone={maxFilesize:12,maxFiles:25,renameFile:function(e){return(new Date).getTime()+"_"+(Math.random().toString(36).substring(2,8)+Math.random().toString(36).substring(2,8))+"_"+e.name.replace(/\s/g,"").replace(/\(/g,"_").replace(/\)/g,"")},thumbnailWidth:125,acceptedFiles:".png,.jpeg,.jpg,.pdf,.doc,.docx,.xls,.xlsx,.csv,.zip,.html,.rar,.css,.js,.txt,.json",addRemoveLinks:!0,dictFileTooBig:"File is too big ({{filesize}}MB). Max filesize: {{maxFilesize}}MB.",dictRemoveFile:"x",timeout:5e4,init:function(){var e=this;function t(e,t,a){var i=e.name.split(".").pop();if("pdf"==i?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/pdf_icon.png"):-1!=i.indexOf("doc")||-1!=i.indexOf("docx")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/doc_icon.png"):-1!=i.indexOf("xls")||-1!=i.indexOf("xlsx")||-1!=i.indexOf("csv")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/xls_icon.png"):-1!=i.indexOf("zip")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/zip.png"):-1!=i.indexOf("rar")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/rar.png"):-1!=i.indexOf("html")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/html.png"):-1!=i.indexOf("css")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/css.png"):-1!=i.indexOf("json")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/json.png"):-1!=i.indexOf("js")?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/js.png"):-1!=i.indexOf("txt")&&$(e.previewElement).find(".dz-image img").attr("src","/assets/img/text.png"),"undefined"===$(e.previewElement).find(".download-link").attr("href")&&$(e.previewElement).find(".download-link").hide(),$(e.previewElement).find(".download-link").length<1){var r=document.createElement("a");r.setAttribute("href",route("projects.index")+"/media/"+a+"?project_id="+projectId),r.setAttribute("class","download-link"),r.innerHTML="<br>Download",e.previewElement.appendChild(r)}$(".dz-image").last().find("img").attr({width:"100%",height:"100%"})}$.get(route("projects.attachments",projectId),(function(t){$.each(t.data,(function(t,a){var i={name:a.name,id:a.id};e.options.addedfile.call(e,i,i.id),e.options.thumbnail.call(e,i,a.url),e.emit("complete",i),e.emit("thumbnail",i,a.url,i.id),$(".dz-remove").eq(t).attr("data-file-id",a.id),$(".dz-remove").eq(t).attr("data-file-url",a.url)}))})),this.on("thumbnail",(function(e,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;$(e.previewTemplate).find(".dz-details").css("display","none"),t(e,a,i);var r=e.name.split("."),n=r[0].replace(/\s/g,"").replace(/\(/g,"_").replace(/\)/g,""),o=e.name.split(".").pop(),s="",d=!0;$(e.previewElement).find(".download-link").on("click",(function(){d=!1})),$.inArray(o,["jpg","JPG","jpeg","png","PNG"])>-1&&(s='<a class="'+n+'" data-fancybox="gallery" href="'+a+'" data-toggle="lightbox" data-gallery="example-gallery"></a>',$(".previewEle").append(s)),e.previewElement.addEventListener("click",(function(){if(d){var t=e.previewElement.querySelector("[data-dz-name]").innerHTML,i=t.split(".").pop();if($.inArray(i,["jpg","JPG","jpeg","png","PNG"])>-1){var r=t.split(".")[0];$("."+r).trigger("click")}else window.open(a,"_blank")}d=!0}))})),this.on("addedfile",(function(e,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t(e,a,i)}))},processing:function(){$(".dz-remove").html("x"),$(".dz-details").hide()},removedfile:function(e){swal({title:deleteHeading+" !",text:deleteMessage+' "'+deleteAttachment+'" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777EF",cancelButtonColor:"#d33",cancelButtonText:noMessages,confirmButtonText:yesMessages},(function(){var t,a=e.previewElement.querySelector("[data-file-id]").getAttribute("data-file-id");return screenLock(),$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="_token"]').attr("content")},type:"post",url:route("project.delete-attachment",a),data:{filename:name,project_id:projectId},complete:function(){location.reload(!0)},error:function(e){console.log("error",e),displayErrorMessage(e.responseJSON.message)}}),null!=(t=e.previewElement)?t.parentNode.removeChild(e.previewElement):void 0}))},success:function(e,t){var a=t.data,i=e.previewElement.querySelector("[data-dz-name]"),r=a.file_name,n=r.split("."),o=n[0],s=n[1],d=i.innerHTML.split(".")[0].replace(/\s/g,"").replace(/\(/g,"_").replace(/\)/g,"");i.innerHTML=r,$(e.previewTemplate).find(".dz-remove").attr("data-file-id",a.id),$(e.previewTemplate).find(".dz-remove").attr("data-file-url",a.file_url),$(e.previewElement).find(".download-link").attr("href",route("projects.index")+"/media/"+a.id+"?project_id="+projectId),$.inArray(s,["jpg","JPG","jpeg","png","PNG"])>-1?($(".previewEle").find("."+d).attr("href",a.file_url),$(".previewEle").find("."+d).attr("class",o)):(e.previewElement.addEventListener("click",(function(){window.open(a.file_url,"_blank")})),$(e.previewElement).find(".download-link").addClass("sdfaskdfjaksdfjaskldfjlasdf"))},error:function(e,t){var a,i=e.name.split(".").pop().toLowerCase();return-1==$.inArray(i,["png","jpg","jpeg","xls","xlsx","csv","pdf","doc","docx","zip","html","css","rar","txt","js","json"])?swal({title:"Error!",text:"The attachment must be a file of type: jpeg, jpg, png, xls, xlsx, pdf, doc, zip, rar, html, css, js, txt, json, csv, docx",type:"error",confirmButtonColor:"#6777EF",timer:5e3}):t.message?swal("Error!",t.message,"error"):swal("Error!",t,"error"),null!=(a=e.previewElement)?a.parentNode.removeChild(e.previewElement):void 0}}})();