(()=>{"use strict";isShow||$((function(){$("#no-record-info-msg").hide(),$("#user-drop-down-body").hide(),$("#project_filter,#filter_user,#filter_task").select2({width:"100%",sorter:function(e){return e.sort((function(e,t){return e.text>t.text?1:e.text<t.text?-1:0}))}}),$("#filter_per_page").select2({width:"100%"}),setTimeout((function(){$("#filter_user").select2({width:"100%"}).trigger("change")}),100),$("#filter_status").select2({width:"100%"}),$("#assignTo,#editAssignTo").select2({width:"100%",placeholder:"Select Assignee"}),$("#projectId,#editProjectId").select2({width:"100%",placeholder:"Select Project"}),$("#priority,#editPriority").select2({width:"100%"}),$("#assignee,#editAssignee,#editAssigneeField").select2({width:"100%",placeholder:"Select Assignee"}),canManageTags?$("#tagIds,#editTagIds").select2({width:"100%",tags:!0,placeholder:"Select Tags",createTag:function(e){var t=!1;if($("#tagIds option").each((function(){$.trim(e.term).toUpperCase()===$.trim($(this).text()).toUpperCase()&&(t=!0)})),!t)return{id:e.term,text:e.term}}}):$("#tagIds,#editTagIds").select2({width:"100%",placeholder:"Select Tags"}),$("#dueDate,#editDueDate").datetimepicker({format:"YYYY-MM-DD",useCurrent:!1,locale:"ar"==languageName?"en":languageName,icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,minDate:moment().millisecond(0).second(0).minute(0).hour(0)}),$("#dueDateFilter, #dueDate").datetimepicker({format:"YYYY-MM-DD",useCurrent:!1,locale:"ar"==languageName?"en":languageName,widgetPositioning:{horizontal:"left",vertical:"bottom"},icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons",clear:"icon-trash icons"},sideBySide:!0,showClear:!0}),$("#dueDateFilter, #dueDate, #editDueDate").on("dp.show",(function(){matchWindowScreenPixels({dueDateFilter:"#dueDateFilter",dueDate:"#dueDate",editDueDate:"#editDueDate"},"tsk")})),s.ajax.reload(),$("input.complete-task-checkbox").prop("disabled",!0),$(document).ajaxComplete((function(e){$("input.complete-task-checkbox").prop("disabled",!1)})),$(window).resize((function(){matchWindowScreenPixels({dueDateFilter:"#dueDateFilter",dueDate:"#dueDate",editDueDate:"#editDueDate"},"tsk")})).trigger("resize"),s.ajax.reload(),$(".editDueDate").on("dp.show",(function(){320===$(window).innerWidth()&&$(".due-date-wrapper .editDueDate + .bootstrap-datetimepicker-widget.dropdown-menu").addClass("dtPickerForListing320-tsk")})),$("input.complete-task-checkbox").prop("disabled",!0),$(document).ajaxComplete((function(e){$("input.complete-task-checkbox").prop("disabled",!1)})),$('[data-toggle="tooltip"]').tooltip()})),$(document).ready((function(){scrollToTheBottom(),$(".nav-tabs a").on("show.bs.tab",(function(){1===$(this).data("for-comment")&&scrollToTheBottom()}))})),window.scrollToTheBottom=function(){setTimeout((function(){var e=$("#itemsWrapper").outerHeight();$(".task-chat-content").scrollTop(e*e)}),200)};var e,t,a,n,i,r=[],o=[];if(!isShow)var s=$("#task_table").DataTable({processing:!0,serverSide:!0,order:[[5,"desc"]],ajax:{url:route("tasks.index"),data:function(e){e.filter_project=$("#project_filter").find("option:selected").val(),e.filter_user=$("#filter_user").find("option:selected").val(),e.filter_status=$("#filter_status").find("option:selected").val(),e.due_date_filter=$("#dueDateFilter").val()}},columnDefs:[{targets:[7],orderable:!1,width:"9%"},{targets:[0],width:"2%",className:"text-center",orderable:!1},{targets:[2],orderable:!1},{targets:[3],width:"6%"},{targets:[4,5],width:"10%",className:"text-center"},{targets:[6],width:"6%",className:"text-center"}],columns:[{data:function(e){return 1==e.status?'<div class="active_btn" title="Mark as pending"><input name="yes" id="enabled" class="enabled" type="checkbox" checked data-check="'+e.id+'"></div>':'<div class="active_btn" title="Mark as complete"><input name="no" id="disabled" type="checkbox" class="enabled" data-check="'+e.id+'"></div>'},name:"status"},{data:function(e){return'<a href="'+(taskUrl+e.project.prefix+"-"+e.task_number)+'">'+e.title+"</a>"},name:"title"},{data:function(e){var t="";return $(e.task_assignee).each((function(e,a){t+='<img class="assignee__avatar" src="'+a.img_avatar+'" data-toggle="tooltip" title="'+a.name+'">'})),t},name:"taskAssignee.name"},{data:function(e){var t=e.priority;return'<i class="fa fa-arrow-up" style="color: '+{highest:"#FF0000",high:"#FF3333",medium:"#FF8000",low:"#336600",lowest:"#4C9900"}[t]+'"></i> '+t.charAt(0).toUpperCase()+t.slice(1)},name:"priority"},{data:function(e){return e},render:function(e){if(null==e.due_date||""===e.due_date)return"";var t=(new Date).toISOString().split("T")[0];return 0===e.status&&t>e.due_date?'<span class="text-danger">'+format(e.due_date)+"</span>":format(e.due_date)},name:"due_date"},{data:function(e){return e},render:function(e){return'<span data-toggle="tooltip" title="'+format(e.created_at,"hh:mm:ss a")+'">'+format(e.created_at)+"</span>"},name:"created_at"},{data:function(e){return e.created_user?'<img class="assignee__avatar" src="'+e.created_user.img_avatar+'" data-toggle="tooltip" title="'+e.created_user.name+'">':""},name:"createdUser.name"},{data:function(e){var t=[];$.each(e.task_assignee,(function(e,a){t.push(a.id)}));var a='<a title="Details" data-toggle="modal" class="btn action-btn btn-info btn-sm taskDetails mr-1"  data-target="#taskDetailsModal" data-id="'+e.id+'"> <i class="fa fa-clock action-icon"></i></a><a title="Edit" class="btn action-btn btn-primary btn-sm mr-1 task-edit-btn" data-id="'+e.id+'"><i class="cui-pencil action-icon"></i></a><a title="Delete" class="btn action-btn btn-danger btn-sm btn-task-delete" data-task-id="'+e.id+'"><i class="cui-trash action-icon"></i></a>';return $.inArray(loggedInUserId,t)>-1&&(a+='<a title="Add Time Entry" class="btn btn-success action-btn btn-sm entry-model ml-1" data-toggle="modal" data-target="#timeEntryAddModal" data-id="'+e.id+'" data-project-id="'+e.project.id+'"><i class="fa fa-user-clock action-icon"></i></a>'),a},name:"id"}],fnInitComplete:function(){$("#project_filter,#filter_status,#filter_user").change((function(){s.ajax.reload()})),$("#dueDateFilter").on("dp.change",(function(e){s.ajax.reload()}))}});function d(e,t){o=[],$("#"+t).empty(),$("#"+t).trigger("change"),$.ajax({url:route("users-of-projects")+"?projectIds="+e,type:"GET",success:function(e){var a=e.data;for(var n in a)a.hasOwnProperty(n)&&($("#"+t).append($("<option>",{value:n,text:a[n]})),o.push(n));""===$("#projectId").val()||isShow||($("#"+t).val(currentLoggedInUserId),$("#"+t).trigger("change.select2"))}})}$("#task_table").on("draw.dt",(function(){$(".tooltip").tooltip("hide"),setTimeout((function(){$('[data-toggle="tooltip"]').tooltip()}))})),$(document).on("click",".task-edit-btn",(function(e){var t=$(e.currentTarget).attr("data-id");$.ajax({url:route("tasks.edit",t),type:"GET",success:function(e){if(e.success){var t=e.data.task,a=e.data.tags,n=document.createElement("textarea");n.innerHTML=t.title,$("#editTagIds").empty(),$.each(a,(function(e,t){$("#editTagIds").append($("<option>",{value:e,text:t}))}));var i=t.description;quillEdit.clipboard.dangerouslyPasteHTML(0,i),$("#tagId").val(t.id),$("#editTitle").val(n.value),$("#taskEditDescription").val(t.description),$("#editDueDate").val(t.due_date),$("#editProjectId").val(t.project.id).trigger("change"),$("#editStatus").val(t.status);var o=[],s=[];r=[],$(t.tags).each((function(e,t){o.push(t.id)})),$(t.task_assignee).each((function(e,t){s.push(t.id),r.push(t.id)})),$("#editTagIds").val(o).trigger("change"),$("#editAssignee").val(s).trigger("change"),$("#editPriority").val(t.priority).trigger("change"),setTimeout((function(){$.each(t.task_assignee,(function(e,t){$("#editAssignee option[value='"+t.id+"']").prop("selected",!0).trigger("change")})),$("#EditModal").appendTo("body").modal("show")}),1500)}},error:function(e){manageAjaxErrors(e)}})})),$(document).on("click",".task-delete-btn",(function(e){var t=$(e.currentTarget).attr("data-id");deleteItem(route("tasks.destroy",t),"#task_table","Task")})),$(document).on("click",".delete-recent-task,.delete-older-task",(function(e){var t=$("#search").val(),a=$(e.currentTarget).attr("data-id"),n=localStorage.getItem("currentTaskId");if(a==n)return displayErrorMessage("Please stop task timer."),!1;swal({title:deleteHeading+" !",text:deleteMessage+' "Task" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777EF",cancelButtonColor:"#d33",cancelButtonText:noMessages,confirmButtonText:yesMessages},(function(){$.ajax({url:route("tasks.destroy",a),type:"DELETE",dataType:"json",success:function(e){e.success&&(window.livewire.emit("refresh"),$("#search").val(t)),swal({title:"Deleted!",text:"Task has been deleted.",type:"success",confirmButtonColor:"#6777EF",timer:2e3})},error:function(e){swal({title:"",text:e.responseJSON.message,type:"error",confirmButtonColor:"#6777EF",timer:5e3})}})}))})),$(document).on("submit","#addNewForm",(function(e){e.preventDefault();var t=""===$("<div />").html($("#taskDescription").summernote("code")).text().trim().replace(/ \r\n\t/g,""),a=jQuery(this).find("#btnTaskSave");if(a.button("loading"),$("#taskDescription").summernote("isEmpty"))$("#taskDescription").val("");else if(t)return displayErrorMessage("Description field is not contain only white space"),a.button("reset"),!1;for(var n=new FormData($(this)[0]),i=$("#Add_attachment")[0].files,r=0;r<i.length;r++)n.append("file[]",i[r]);$.ajax({url:route("tasks.store"),type:"POST",data:n,contentType:!1,processData:!1,success:function(e){e.success&&(displaySuccessMessage(e.message),$("#AddModal").modal("hide"),$("#task_table").DataTable().ajax.reload(),revokerTracker(),window.livewire.emit("refresh"))},error:function(e){printErrorMessage("#validationErrorsBox",e)},complete:function(){a.button("reset")}})})),$(document).on("submit",".editForm",(function(e){var t=""===$("<div />").html($("#taskEditDescriptionContainer").summernote("code")).text().trim().replace(/ \r\n\t/g,"");$(this);e.preventDefault();var a=jQuery(this).find('[type="submit"]');a.button("loading");var n=$(this).find(".taskId").val(),i=getItemFromLocalStorage("task_id"),r=getItemFromLocalStorage("clockRunning");if(n===i&&"true"===r)return s.ajax.reload(),swal({title:"Warning",text:"Please stop timer before updating task.",type:"warning",confirmButtonColor:"#6777ef"}),a.button("reset"),!1;if($("#taskEditDescriptionContainer").summernote("isEmpty"))$("#taskEditDescriptionContainer").val("");else if(t)return displayErrorMessage("Description field is not contain only white space"),a.button("reset"),!1;var o=$(this).serializeArray();$.ajax({url:route("tasks.update",n),type:"put",data:o,success:function(e){e.success&&(displaySuccessMessage(e.message),$("#EditModal").modal("hide"),$("#task_table").DataTable().ajax.reload(),revokerTracker(),window.livewire.emit("refresh"))},error:function(e){manageAjaxErrors(e)},complete:function(){a.button("reset")}})})),$("#AddModal").on("hidden.bs.modal",(function(){$("#taskDescription").summernote("code",""),$("#projectId").val(null).trigger("change"),$("#assignee").val(null).trigger("change"),$("#tagIds").val(null).trigger("change"),$("#priority").val(null).trigger("change"),$("#dueDate").data("DateTimePicker").clear(),$("#estimateTimeHours").data("DateTimePicker").date("00:00"),$("#Days").removeClass("btn btn-primary text-white"),$("#Hours").addClass("btn btn-primary text-white"),$("#types").val(0),$("#estimateTimeDays").hide().val(""),$("#estimateTimeHours").show().val(""),$("#previewImage").empty(),document.getElementById("Add_attachment").files=null,resetModalForm("#addNewForm","#validationErrorsBox"),h()})),$("#EditModal").on("hidden.bs.modal",(function(){$("#taskEditDescription").summernote("code",""),$("#attachments").empty(),$("#previewImage").empty(),$("#no_attachments").empty(),$("#previewImageEdit").empty(),resetModalForm("#editForm","#editValidationErrorsBox")})),$((function(){$(document).on("change","input.complete-task-checkbox",(function(a){var n=$(this).attr("data-check");t=$(this);var i=getItemFromLocalStorage("task_id"),r=getItemFromLocalStorage("clockRunning");if(n===i&&"true"===r)return s.ajax.reload(),swal({title:"Warning",text:"Please stop timer before completing task.",type:"warning",confirmButtonColor:"#6777EF"}),t.prop("checked",!1),!1;""!=$("#filter_status").val()&&$(this).parentsUntil(".task-list").toggle("slide"),"undefined"!=typeof isTask&&e(n)})),e=function(e){$.ajax({url:route("task.update-status",e),type:"POST",cache:!1,success:function(e){e.success&&(window.livewire.emit("refresh"),revokerTracker())}})}})),window.manageCollapseIcon=function(e){"true"===$("#tdCollapse"+e).attr("aria-expanded")?($("#tdCollapse"+e).find("a span").removeClass("fa-minus-circle"),$("#tdCollapse"+e).find("a span").addClass("fa-plus-circle")):($("#tdCollapse"+e).find("a span").removeClass("fa-plus-circle"),$("#tdCollapse"+e).find("a span").addClass("fa-minus-circle"))},window.deleteTimeEntry=function(e){swal({title:"Delete !",text:"Are you sure you want to delete this Time Entry?",type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777EF",cancelButtonColor:"#d33",cancelButtonText:"No",confirmButtonText:"Yes"},(function(){$.ajax({url:route("time-entries.destroy",e),type:"DELETE",dataType:"json",success:function(e){e.success&&$(".close").trigger("click"),swal({title:"Deleted!",text:"Time Entry has been deleted.",type:"success",confirmButtonColor:"#6777EF",timer:2e3})},error:function(e){swal({title:"",text:e.responseJSON.message,type:"error",confirmButtonColor:"#6777EF",timer:5e3})}})}))},$(document).on("click",".timeEntryAddModal",(function(e){$("#timeEntryAddModal").appendTo("body").modal("show");var t=$(e.currentTarget).attr("data-id"),a=$(e.currentTarget).attr("data-project-id");$("#timeProjectId").val(a).trigger("change"),getTasksByProject(a,"#taskId",t,"#tmValidationErrorsBox"),setTimeout((function(){$("#taskId").val(t).trigger("change")}),1500)})),$("#taskDescription,#taskEditDescription").summernote({placeholder:"Add Task description...",minHeight:200,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]]}),$(document).on("change","#projectId",(function(e){d($(this).val(),"assignee")})),$(document).on("change","#editProjectId",(function(e){d($(this).val(),"editAssignee"),setTimeout((function(){$("#editAssignee").val(projectTaskAssignees).trigger("change")}),1500)})),$(document).on("focusout",".task-input",(function(){if($(this).val().length>250)return displayErrorMessage("The title may not be greater than 250 characters"),!1;$(".task-name").addClass("disabled");var e=$(this).attr("data-id"),t=a.val();return t===n?($(".task-name").removeClass("disabled"),$(this).hide(),$(this).next(".task-name").show(),!1):(l($(this)),""==t.trim()?($(this).addClass("error"),displayErrorMessage("Enter task name"),!1):($(this).removeClass("error"),void window.livewire.emit("updateTask",t,e)))})),$(".modal").modal({show:!1,backdrop:"static"}),$(document).on("click",".addTasksModal",(function(){$("#notFoundYet").text("No attachments added yet"),$("#AddModal").appendTo("body").modal("show"),$("#projectId").select2({width:"100%",placeholder:"Select Project"})})),$(document).on("keypress",".task-input",(function(e){13==e.which&&$(this).blur()}));var c=[];document.addEventListener("livewire:load",(function(e){window.livewire.hook("message.processed",(function(){$("[rel=tooltip]").tooltip({placement:"top"}),$(document).on("click",".task-name",(function(){n=$(this).text(),$(this).hide(),(a=$(this).prev("input")).show().val(n).focus()}));var e=document.querySelectorAll(".editDueDate");"undefined"!=typeof isTask&&$(e).datetimepicker({format:"YYYY-MM-DD",useCurrent:!1,locale:"ar"==languageName?"en":languageName,icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons"},sideBySide:!0,minDate:moment().millisecond(0).second(0).minute(0).hour(0)}),$(".editPriority").select2({width:"100%"}),canManageTags?$(".editTagIds").select2({width:"100%",placeholder:"Select Tags",tags:!0,sorter:function(e){return e.sort((function(e,t){return e.text>t.text?1:e.text<t.text?-1:0}))},createTag:function(e){var t=document.createElement("textarea");t.innerHTML=e.term;var a=!1;if($("#editTagIds option").each((function(){$.trim(e.term).toUpperCase()===$.trim($(this).text()).toUpperCase()&&(a=!0)})),!a)return{id:e.term,text:t.value}}}):$(".editTagIds").select2({width:"100%",placeholder:"Select Tags"}),$(".editProjectIds").select2({width:"100%",placeholder:"Select Project",sorter:function(e){return e.sort((function(e,t){return e.text>t.text?1:e.text<t.text?-1:0}))}});var t=document.querySelectorAll("div.task-detail"),i=0;$.each(t,(function(e,t){$(".taskEditDescriptionContainer-"+e).summernote("destroy")})),$.each(t,(function(e,t){c[i++]=$(".taskEditDescriptionContainer-"+e).summernote({placeholder:"Add Task description...",minHeight:200,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]]})}))}))})),$(document).on("dp.change",".editDueDate",(function(e){var t=$(this).val();window.livewire.emit("updateTaskDueDate",t,i)})),$(document).on("click",".editDueDate",(function(){i=$(this).attr("data-id")})),$(document).on("click",".task-detail-link",(function(){$(".task-detail-card").toggleClass("toggle")})),$(document).ready((function(){$("#filter_status").trigger("change")})),$("#filter_status").change((function(){window.livewire.emit("filterTasksByStatus",$(this).val())})),$("#project_filter").change((function(){window.livewire.emit("filterTasksByProject",$(this).val())})),$(document).on("change","#filter_user",(function(){$("#project_filter").empty();var e=isEmpty($(this).val())?loginUserId:$(this).val();$.ajax({url:route("project-by-users",e),type:"GET",success:function(e){if(e.success){var t=e.data;for(var a in $("#project_filter").find("option").remove().end().append('<option value="">All</option>'),t)t.hasOwnProperty(a)&&$("#project_filter").append($("<option>",{value:a,text:t[a]}))}},error:function(e){manageAjaxErrors(e)}}),window.livewire.emit("filterTasksByUser",$(this).val())})),$("#dueDateFilter").on("dp.change",(function(e){window.livewire.emit("filterTasksByDueDate",$(this).val())})),$("#filter_per_page").change((function(e){window.livewire.emit("filterPerPage",$(this).val())})),$("#filter_task").change((function(e){window.livewire.emit("orderByFilter",$(this).val())})),$(document).on("click",".edit-task-assignees",(function(e){var t=$(e.currentTarget).attr("data-id");startLoader(),$.ajax({url:route("task.edit-assignee",t),type:"GET",success:function(e){if(e.success){var t=e.data.task,a=e.data.users;for(var n in $("#editAssigneeField").empty(),a)a.hasOwnProperty(n)&&$("#editAssigneeField").append($("<option>",{value:n,text:a[n]}));$("#hdnTaskId").val(t.id);var i=e.data.task_assignee;r=e.data.task_assignee,$("#editAssigneeField").val(i).trigger("change"),setTimeout((function(){$("#editAssigneeField").val(e.data.task_assignee).trigger("change")}),1e3),stopLoader(),$("#EditAssigneeModal").appendTo("body").modal("show")}},error:function(e){manageAjaxErrors(e)}})})),$(document).on("click","#EditAssigneeModal #btnSaveAssignees",(function(){var e=jQuery(this);e.button("loading"),window.livewire.emit("updateAssignees",$("#editAssigneeField").val(),$("#hdnTaskId").val()),$("#EditAssigneeModal").modal("hide"),$("#EditAssigneeModal").on("hidden.bs.modal",(function(){e.button("reset")}))}));var l=function(e){e.closest(".task-item").addClass("loading"),setTimeout((function(){e.closest(".task-item").removeClass("loading")}),3e3)},u=null,m=null,p=null,g=null,f=null;function h(){document.querySelector("#Add_attachment").addEventListener("change",y,!1)}$(document).on("click",".editRecord",(function(){u=$(this).data("record-index"),m=$(document).find("[data-edit-priority='"+u+"']").val(),p=$(document).find("[data-edit-tags='"+u+"']").val().toString().split(","),g=$(document).find("[data-edit-project='"+u+"']").val(),f=$(c[u]).summernote("code")})),$(document).on("click",".elementCancel",(function(){$(document).find("[data-edit-priority='"+u+"']").val(m).trigger("change"),$(document).find("[data-edit-tags='"+u+"']").val(p).trigger("change"),$(document).find("[data-edit-project='"+u+"']").val(g).trigger("change"),$(c[u]).summernote("code",f)})),$(".task-action .dropdown").hover((function(){$(this).find(".dropdown-menu").stop(!0,!0).delay(100).fadeIn(500)}),(function(){$(this).find(".dropdown-menu").stop(!0,!0).delay(100).fadeOut(500)})),$("#dropdownMenuButton2").click((function(){return!1})),$(".dropdown-large").on("click",(function(e){$(this).parent().hasClass("show")?$(this).parent().toggleClass("show"):$(this).parent().removeClass("show")})),$(document).on("click",".close",(function(){$(".dropdown-large").removeClass("show")})),$(document).ready((function(){$("#estimateTimeHours").datetimepicker({format:"HH:mm",useCurrent:!1,locale:"ar"==languageName?"en":languageName,icons:{previous:"icon-arrow-left icons",next:"icon-arrow-right icons",up:"icon-arrow-up icons",down:"icon-arrow-down icons"},sideBySide:!0}),$("#estimateTimeDays").hide(),$(document).on("click","#Hours",(function(){$("#Days").removeClass("btn btn-primary text-white"),$(this).addClass("btn btn-primary text-white"),$("#types").val(0),$("#estimateTimeDays").hide().val(""),$("#estimateTimeHours").show()})),$(document).on("click","#Days",(function(){$("#Hours").removeClass("btn btn-primary text-white"),$(this).addClass("btn btn-primary text-white"),$("#types").val(1),$("#estimateTimeHours").data("DateTimePicker").date("00:00"),$("#estimateTimeHours").hide().val(""),$("#estimateTimeDays").show()}))})),$(document).on("click","#resetFilters",(function(){$("#project_filter").val(null).trigger("change"),$("#dueDateFilter").data("DateTimePicker").clear(),$("#filter_status").val(0).trigger("change"),$("#filter_per_page").val(10).trigger("change"),$("#filter_task").val(orderId).trigger("change"),canManageProjects&&($("#filter_user").val(loggedInUserId).trigger("change"),window.livewire.emit("filterTasksByUser",$("#filter_user").val())),window.livewire.emit(["filterTasksByProject",$("#project_filter").val()],["filterTasksByDueDate",$("#dueDateFilter").val()],["filterTasksByStatus",$("#filter_status").val()],["filterPerPage",$("#filter_per_page").val()],["orderByFilter",$("#filter_task").val()])})),document.addEventListener("DOMContentLoaded",h,!1),$(".btn-upload").hide();var v=[],w=new DataTransfer,k={};function y(e){e.preventDefault(),$("#notFoundYet").text(""),k=e.target.files;for(var t="",a=0;a<k.length;a++){var n=k[a].name.split(".").pop().toLowerCase();if(-1==$.inArray(n,["png","jpg","jpeg","xls","xlsx","csv","pdf","doc","docx"]))return displayErrorMessage("The attachment must be a file of type: jpeg, jpg, png, xls, xlsx, pdf, doc"),$("#notFoundYet").append("No attachments added yet").addClass("text-center"),$("#previewImage").empty(),!1;if(v.push(a),k[a].size>1e6)return displayErrorMessage("The attachment size should not greater than 12 mb."),$(this).val(""),1==v.length&&$("#notFoundYet").append("No attachments added yet").addClass("text-center"),!1;var i=URL.createObjectURL(e.target.files[a]);"xlsx"!==n&&"xls"!==n&&"csv"!==n||(i="/assets/img/xls_icon.png"),"pdf"===n&&(i="/assets/img/pdf_icon.png"),"docx"!==n&&"doc"!==n||(i="/assets/img/doc_icon.png"),t+='\n                <div class="col-sm-3 mt-3 text-center" id="divImageId'.concat(a,'">\n           \n                                    <a class="fancybox preview-image-thumb" target="_blank"\n                                                                   alt="#"> <img class="x-image"  src="').concat(i,'" />\n                                                               </a>\n                                                     \n                 <div class="x-details">\n                      \n                                                                <div class="x-actions"><strong>\n                                                                        <a href="" class="download-attachment"><?php echo __(\'messages.expense.download\')?> <span class="x-icons"><i class="ti-download"></i></span></a></strong>\n                                                                    <span>\n                                                             \n                                                                    <a href="javascript:void(0)"\n                                                                                class="text-danger delete-attachment" data-id=""><?php echo __(\'messages.common.delete\') ?> </a> </span>\n                                                                                <a href="javascript:void(0)" class="text-danger delete-add-attachment text-center text-decoration-none "   data-key="').concat(a,'" data-id="divImageId').concat(a,'">Delete</a>\n                                                               \n                                                                </div>\n                                                            </div>\n                 </div>')}$(".previewImage").html(t)}function x(e){e.preventDefault();var t=e.target.files,a=$("#tagId").val();t.length;for(var n=0;n<t.length;n++){var i=t[n].name.split(".").pop().toLowerCase();if(-1==$.inArray(i,["png","jpg","jpeg","xls","xlsx","csv","pdf","doc","docx"]))return displayErrorMessage("The attachment must be a file of type: jpeg, jpg, png, xls, xlsx, pdf, doc"),$(this).val(""),!1;if(t[n].size>1e6)return displayErrorMessage("The attachment size should not greater than 12 mb."),$(this).val(""),!1;var r=new FormData;r.append("file",t[n]),$.ajax({url:route("task.add-attachment",a),type:"post",data:r,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(e){var t=e.data;if(e.success){$("#noAttachmentFound").empty();var a,n=t.file_name.split(".").pop(),i=[];i=t.file_url,"xlsx"!==n&&"xls"!==n&&"csv"!==n||(i="/assets/img/xls_icon.png"),"pdf"===n&&(i="/assets/img/pdf_icon.png"),"docx"!==n&&"doc"!==n||(i="/assets/img/doc_icon.png"),a=[{id:t.id,url:t.file_url,image:i,username:t.user,downloadTask:route("tasks.index"),updated_at:moment(t.updated_at).fromNow(),createdId:t.userId,loginUserId:loggedInUserId}],$("#previewImageEdit").append(prepareTemplateRender("#attachmentImage",a))}scrollToTheBottomAttachment()},error:function(e){manageAjaxErrors(e)},complete:function(){}})}}$(document).on("click",".delete-add-attachment",(function(e){var t=$(e.currentTarget).attr("data-id"),a=$(e.currentTarget).attr("data-key");swal({title:deleteHeading+" !",text:deleteMessage+' "'+deleteAttachment+'" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777EF",cancelButtonColor:"#d33",cancelButtonText:noMessages,confirmButtonText:yesMessages},(function(){var e=v.indexOf(a);v.splice(e,1),swal({title:"Deleted!",text:"Attachment has been deleted.",type:"success",confirmButtonColor:"#6777EF",timer:2e3}),w.items.remove(a),document.getElementById("Add_attachment").files=w.files,$("#"+t).remove(),0==v.length&&$("#notFoundYet").append("No attachments added yet").addClass("text-center")}))})),document.addEventListener("DOMContentLoaded",(function(){1!=isShowProject&&document.querySelector("#editTaskAddAttachment").addEventListener("change",x,!1)}),!1),$(".btn-upload").hide(),window.scrollToTheBottomAttachment=function(){setTimeout((function(){var e=$("#card-attachments-container-edit").outerHeight();$(".attachments-content-edit").scrollTop(e*e)}),200)},$(document).on("click",".delete-attachment",(function(){var e=$(this).attr("data-id"),t=$("#taskId").val(),a=$(this).parent().parent().parent().parent().prop("id");swal({title:deleteHeading+" !",text:deleteMessage+' "'+deleteAttachment+'" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#6777EF",cancelButtonColor:"#d33",cancelButtonText:noMessages,confirmButtonText:yesMessages},(function(){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="_token"]').attr("content")},type:"post",url:route("task.delete-attachment",e),data:{filename:name,id:t},success:function(){swal({title:"Deleted!",text:"Attachment has been deleted.",type:"success",confirmButtonColor:"#6777EF",timer:2e3}),$("#"+a).remove(),$.trim($("#previewImageEdit").html())||$("#noAttachmentFound").append("No attachments added yet").addClass("text-center")},error:function(e){manageAjaxErrors()}})}))}))})();